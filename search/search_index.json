{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Open-Source IS-IS Configuration Labs This series of hands-on labs will help you master the IS-IS routing protocol configuration on a platform of your choice 1 , including: Arista EOS Cisco ASAv, IOSv, IOS XE, IOS XR and Nexus OS FRRouting Dell OS10 Juniper vSRX, vMX and vPTX Nokia SR OS and SR Linux Vyatta VyOS Tip If this is your first visit to this site, you should start with the Installation and Setup documentation or run labs in GitHub codespaces . The initial lab exercises will help you configure basic IS-IS features: Work with FRRouting (optional) Start the IS-IS Routing for IPv4 Explore IS-IS Data Structures IS-IS on Point-to-Point Links Using IS-IS Metrics Dual-Stack (IPv4+IPv6) IS-IS Routing Optimize Simple IS-IS Deployments Want to know what else we have planned? Check the Upcoming Lab Exercises document. Some assembly required: the virtual machines or containers that we recommend to use as external IS-IS speakers are easy to download, but you\u2019ll have to build a Vagrant box or install a vendor-supplied Vagrant box or Docker container image for most other platforms. See installation and setup for details. \u21a9","title":"Labs Overview"},{"location":"#open-source-is-is-configuration-labs","text":"This series of hands-on labs will help you master the IS-IS routing protocol configuration on a platform of your choice 1 , including: Arista EOS Cisco ASAv, IOSv, IOS XE, IOS XR and Nexus OS FRRouting Dell OS10 Juniper vSRX, vMX and vPTX Nokia SR OS and SR Linux Vyatta VyOS Tip If this is your first visit to this site, you should start with the Installation and Setup documentation or run labs in GitHub codespaces . The initial lab exercises will help you configure basic IS-IS features: Work with FRRouting (optional) Start the IS-IS Routing for IPv4 Explore IS-IS Data Structures IS-IS on Point-to-Point Links Using IS-IS Metrics Dual-Stack (IPv4+IPv6) IS-IS Routing Optimize Simple IS-IS Deployments Want to know what else we have planned? Check the Upcoming Lab Exercises document. Some assembly required: the virtual machines or containers that we recommend to use as external IS-IS speakers are easy to download, but you\u2019ll have to build a Vagrant box or install a vendor-supplied Vagrant box or Docker container image for most other platforms. See installation and setup for details. \u21a9","title":"Open-Source IS-IS Configuration Labs"},{"location":"1-setup/","text":"Software Installation and Lab Setup It\u2019s easiest to use the IS-IS labs with netlab . Still, you can use most of them (potentially with slightly reduced functionality) with any other virtual lab environment or on physical gear. For the rest of this document, we\u2019ll assume you decided to use netlab ; if you want to set up your lab in some other way, read the Manual Setup section of the BGP Labs documentation. Warning IS-IS labs work best with netlab release 1.8.4 or later. If you\u2019re using an earlier netlab release, please upgrade with pip3 install --upgrade networklab . Select the Network Devices You Will Work With You can run FRRouting in all netlab -supported virtualization environments (VirtualBox, libvirt, or Docker) 2 , and if you want to start practicing IS-IS with minimum hassle, consider using FRRouting for all lab devices. You can even run FRRouting containers on Macbooks with Apple silicon . If you\u2019d like to use a more traditional networking device, use any other netlab -supported device for which we implemented basic IS-IS configuration as the device to practice with 1 . I recommend Arista cEOS or Nokia SR Linux containers; they are the easiest ones to install and use. Tip If you plan to run the labs in free GitHub Codespaces , you MUST use container-based network devices like Arista cEOS, FRR, Nokia SR Linux, or Vyos. Select the Additional Devices in Your Lab Some labs use additional routers \u2013 preconfigured devices with which your routers exchange routing information. You won\u2019t configure those devices, but you might have to log into them and execute show commands. The default setup uses FRRouting for additional routers; we also generated all the show printouts with FRRouting. Alternatively, you can use any other device for which we implemented basic IS-IS configuration as additional routers. Additional limitations (should they exist) are listed under the Device Requirements section of individual lab exercises. Select the Virtualization Environment Now that you know which network device to use, check which virtualization environment you can use. Running IS-IS labs in a free GitHub Codespace is an excellent starting point, but if you decide to build your own infrastructure, containerlab is easier to set up than libvirt , with virtualbox being a distant third. Now for a few gotchas: You can use virtualbox if you want to run the lab devices as virtual machines on your Windows- or MacOS laptop with Intel CPU, but even then, I\u2019d prefer running them in a Ubuntu VM . Your hardware and virtualization software (for example, VirtualBox or VMware Fusion) must support nested virtualization if you want to use libvirt on that Ubuntu VM. You don\u2019t need nested virtualization to run Docker containers unless you\u2019re using the crazy trick we\u2019re forced to use for Juniper vMX or Nokia SR OS \u2013 they\u2019re running as a virtual machine within a container . Software Installation Based on the choices you made, you\u2019ll find the installation instructions in one of these documents: Using GitHub Codespaces Ubuntu VM Installation on Windows or MacOS Ubuntu Server Installation Running netlab on any other Linux Server Running netlab in a Public Cloud Running netlab on Apple silicon Discouraged: Virtualbox-Based Lab on Windows or MacOS Once you have completed the software installation you have to deal with the stupidities of downloading and installing network device images ( Virtualbox , libvirt , containers ) unless you decided to use FRR, Nokia SR Linux, or Vyos. I would love to simplify the process, but the networking vendors refuse to play along. Even worse, their licenses prohibit me from downloading the images and creating a packaged VM with preinstalled network devices for you 3 . Fortunately, you only have to go through this colossal waste of time once. Setting Up the Labs We finally got to the fun part \u2013 setting up the labs. If you\u2019re not using GitHub Codespaces: Select a directory where you want to have the IS-IS labs Clone the isis GitHub repository with git clone https://github.com/bgplab/isis.git . GitHub UI gives you other options in the green Code button, including Download ZIP After you get a local copy of the repository: If needed, edit the defaults.yml file in the top directory to set your preferred network device and virtualization environment. For example, I\u2019m using the following settings to run the labs with Arista EOS containers while using FRRouting as the external IS-IS routers: device: eos # Change to your preferred network device provider: clab # Change to virtualbox or libvirt if needed groups: external: device: frr # Change to your preferred external router In a terminal window, change the current directory to one of the lab directories (for example, basic/1-simple-ipv4 ), and execute netlab up . Wait for the lab to start and use netlab connect to connect to individual lab devices Have fun. When you\u2019re done, collect the device configurations with netlab collect (if you want to save them) and shut down the lab with netlab down Change the current directory to another lab directory and repeat. Once you run out of lab exercises, create a new one and contribute it with a pull request ;) Most network devices require an x86 CPU. You must run the labs on a device with an x86 CPU (Intel or AMD) to use them. \u21a9 There is no official FRR virtual machine image \u2013 netlab has to download and install FRR on a Ubuntu VM whenever you start an frr node as a virtual machine. Using FRR containers is faster and consumes way less bandwidth or memory. \u21a9 I\u2019m not going to pay a lawyer to read their boilerplate stuff, and I\u2019m definitely not going to rely on my amateur understanding of US copyright law. \u21a9","title":"Installation and Setup"},{"location":"1-setup/#software-installation-and-lab-setup","text":"It\u2019s easiest to use the IS-IS labs with netlab . Still, you can use most of them (potentially with slightly reduced functionality) with any other virtual lab environment or on physical gear. For the rest of this document, we\u2019ll assume you decided to use netlab ; if you want to set up your lab in some other way, read the Manual Setup section of the BGP Labs documentation. Warning IS-IS labs work best with netlab release 1.8.4 or later. If you\u2019re using an earlier netlab release, please upgrade with pip3 install --upgrade networklab .","title":"Software Installation and Lab Setup"},{"location":"1-setup/#select-the-network-devices-you-will-work-with","text":"You can run FRRouting in all netlab -supported virtualization environments (VirtualBox, libvirt, or Docker) 2 , and if you want to start practicing IS-IS with minimum hassle, consider using FRRouting for all lab devices. You can even run FRRouting containers on Macbooks with Apple silicon . If you\u2019d like to use a more traditional networking device, use any other netlab -supported device for which we implemented basic IS-IS configuration as the device to practice with 1 . I recommend Arista cEOS or Nokia SR Linux containers; they are the easiest ones to install and use. Tip If you plan to run the labs in free GitHub Codespaces , you MUST use container-based network devices like Arista cEOS, FRR, Nokia SR Linux, or Vyos.","title":"Select the Network Devices You Will Work With"},{"location":"1-setup/#select-the-additional-devices-in-your-lab","text":"Some labs use additional routers \u2013 preconfigured devices with which your routers exchange routing information. You won\u2019t configure those devices, but you might have to log into them and execute show commands. The default setup uses FRRouting for additional routers; we also generated all the show printouts with FRRouting. Alternatively, you can use any other device for which we implemented basic IS-IS configuration as additional routers. Additional limitations (should they exist) are listed under the Device Requirements section of individual lab exercises.","title":"Select the Additional Devices in Your Lab"},{"location":"1-setup/#select-the-virtualization-environment","text":"Now that you know which network device to use, check which virtualization environment you can use. Running IS-IS labs in a free GitHub Codespace is an excellent starting point, but if you decide to build your own infrastructure, containerlab is easier to set up than libvirt , with virtualbox being a distant third. Now for a few gotchas: You can use virtualbox if you want to run the lab devices as virtual machines on your Windows- or MacOS laptop with Intel CPU, but even then, I\u2019d prefer running them in a Ubuntu VM . Your hardware and virtualization software (for example, VirtualBox or VMware Fusion) must support nested virtualization if you want to use libvirt on that Ubuntu VM. You don\u2019t need nested virtualization to run Docker containers unless you\u2019re using the crazy trick we\u2019re forced to use for Juniper vMX or Nokia SR OS \u2013 they\u2019re running as a virtual machine within a container .","title":"Select the Virtualization Environment"},{"location":"1-setup/#software-installation","text":"Based on the choices you made, you\u2019ll find the installation instructions in one of these documents: Using GitHub Codespaces Ubuntu VM Installation on Windows or MacOS Ubuntu Server Installation Running netlab on any other Linux Server Running netlab in a Public Cloud Running netlab on Apple silicon Discouraged: Virtualbox-Based Lab on Windows or MacOS Once you have completed the software installation you have to deal with the stupidities of downloading and installing network device images ( Virtualbox , libvirt , containers ) unless you decided to use FRR, Nokia SR Linux, or Vyos. I would love to simplify the process, but the networking vendors refuse to play along. Even worse, their licenses prohibit me from downloading the images and creating a packaged VM with preinstalled network devices for you 3 . Fortunately, you only have to go through this colossal waste of time once.","title":"Software Installation"},{"location":"1-setup/#defaults","text":"We finally got to the fun part \u2013 setting up the labs. If you\u2019re not using GitHub Codespaces: Select a directory where you want to have the IS-IS labs Clone the isis GitHub repository with git clone https://github.com/bgplab/isis.git . GitHub UI gives you other options in the green Code button, including Download ZIP After you get a local copy of the repository: If needed, edit the defaults.yml file in the top directory to set your preferred network device and virtualization environment. For example, I\u2019m using the following settings to run the labs with Arista EOS containers while using FRRouting as the external IS-IS routers: device: eos # Change to your preferred network device provider: clab # Change to virtualbox or libvirt if needed groups: external: device: frr # Change to your preferred external router In a terminal window, change the current directory to one of the lab directories (for example, basic/1-simple-ipv4 ), and execute netlab up . Wait for the lab to start and use netlab connect to connect to individual lab devices Have fun. When you\u2019re done, collect the device configurations with netlab collect (if you want to save them) and shut down the lab with netlab down Change the current directory to another lab directory and repeat. Once you run out of lab exercises, create a new one and contribute it with a pull request ;) Most network devices require an x86 CPU. You must run the labs on a device with an x86 CPU (Intel or AMD) to use them. \u21a9 There is no official FRR virtual machine image \u2013 netlab has to download and install FRR on a Ubuntu VM whenever you start an frr node as a virtual machine. Using FRR containers is faster and consumes way less bandwidth or memory. \u21a9 I\u2019m not going to pay a lawyer to read their boilerplate stuff, and I\u2019m definitely not going to rely on my amateur understanding of US copyright law. \u21a9","title":"Setting Up the Labs"},{"location":"3-upcoming/","text":"Upcoming Labs The first few labs are already online ; the list of ideas is much longer. Here they are: Configure IS-IS Features Passive IS-IS Interfaces Explain the need for passive interfaces Configure passive IS-IS interfaces If available, turn off the advertisement of inter-router prefixes Influence the Designated IS Election Explain the need for DIS priority Configure DIS priority on a router Protect IS-IS Adjacencies with MD5 Authentication Configure IS-IS area- and interface passwords Route Redistribution into IS-IS Configure static route and connected interface redistribution into IS-IS Fast IS-IS Failure Detection and Convergence Configure IS-IS timers Use BFD Advanced Labs Multi-Level IS-IS Networks Explain intra-area and inter-area routing Configure a network with multiple areas and L1/L2 routers Graceful Shutdown with IS-IS Overload Bit Configure IS-IS overload bit or maximum metric to drain traffic from a transit router Build an SR-MPLS Network with IS-IS Build a BGP-free MPLS core using SR-MPLS with IS-IS Configure IS-IS Fast Reroute Using TI-LFA In a triangle network, configure the longer path as a backup path Using IS-IS with SRv6 Build a BGP-free IPv6 core using SRv6 for end-to-end transport Troubleshooting Troubleshoot IS-IS Adjacencies This lab will include the most common mistakes that prevent an IS-IS adjacency from forming, including: MTU mismatch L1/L2 mismatch Area mismatch on L1 adjacency 3-way handshake on point-to-point links","title":"Overview"},{"location":"3-upcoming/#upcoming-labs","text":"The first few labs are already online ; the list of ideas is much longer. Here they are:","title":"Upcoming Labs"},{"location":"3-upcoming/#configure-is-is-features","text":"Passive IS-IS Interfaces Explain the need for passive interfaces Configure passive IS-IS interfaces If available, turn off the advertisement of inter-router prefixes Influence the Designated IS Election Explain the need for DIS priority Configure DIS priority on a router Protect IS-IS Adjacencies with MD5 Authentication Configure IS-IS area- and interface passwords Route Redistribution into IS-IS Configure static route and connected interface redistribution into IS-IS Fast IS-IS Failure Detection and Convergence Configure IS-IS timers Use BFD","title":"Configure IS-IS Features"},{"location":"3-upcoming/#advanced-labs","text":"Multi-Level IS-IS Networks Explain intra-area and inter-area routing Configure a network with multiple areas and L1/L2 routers Graceful Shutdown with IS-IS Overload Bit Configure IS-IS overload bit or maximum metric to drain traffic from a transit router Build an SR-MPLS Network with IS-IS Build a BGP-free MPLS core using SR-MPLS with IS-IS Configure IS-IS Fast Reroute Using TI-LFA In a triangle network, configure the longer path as a backup path Using IS-IS with SRv6 Build a BGP-free IPv6 core using SRv6 for end-to-end transport","title":"Advanced Labs"},{"location":"3-upcoming/#troubleshooting","text":"Troubleshoot IS-IS Adjacencies This lab will include the most common mistakes that prevent an IS-IS adjacency from forming, including: MTU mismatch L1/L2 mismatch Area mismatch on L1 adjacency 3-way handshake on point-to-point links","title":"Troubleshooting"},{"location":"4-codespaces/","text":"Use GitHub Codespaces You can run IS-IS labs in (free 1 ) GitHub codespaces ; all you need is a GitHub account: Create a new codespace for your IS-IS labs or connect to an existing codespace . Unless you\u2019re using GitHub codespaces with VScode (in which case you know what to do), your codespace opens in a new browser window with three tabs: Explorer (repository folders), Preview (starting with README), and Terminal. Select Lab Devices The IS-IS labs repository uses FRRouting containers as the default device. To change the device settings, edit the defaults.yml file with vi or nano . It\u2019s best to use network devices with free-to-download container images: Device Device type to use in defaults.yml FRRouting frr Nokia SR Linux srlinux VyOS vyos Tip Start with the Configuring IS-IS on FRRouting exercise if you want to use the default settings but never worked with FRRouting before. Use FRRouting to use the 2 CPU/8 GB codespaces VM with more extensive labs. Codespaces have persistent storage; you can download and install other containers . To use containers that have to be downloaded from the vendors\u2019 website, download them onto your laptop, drag-and-drop them into the Folders , and install them like you would on a local netlab instance . You cannot run virtual machines in codespaces (yet?). This also precludes running VMs in virtual machines (the vrnetlab approach). Start a Lab Once you have the codespaces up and running: Click on the desired lab exercise in the README.md preview window to select the exercise folder. Right-click on the exercise folder and select \u201c Open in Integrated Terminal \u201d to launch a bash session in the desired directory. Execute netlab up to start the lab. Expand the exercise folder in the Explorer tab. Right-click on the README.md file and select \u201c Open Preview \u201d to open the rendered version of the file. Click the link in the README.md file to get the exercise description in the preview pane. Connect to your devices with the netlab connect command executed in the Terminal pane. Cleanup and Shutdown Finally, don\u2019t forget to shut down the lab with netlab down and stop your codespace after you\u2019re done: Click on the blue \u201c Codespaces \u201d button in the bottom-left corner of the browser window. Select \u201c Stop Current Codespace \u201d. You should also adjust idle timeout and default retention period in your codespaces settings . You get 120 free core hours per month or pay for more . \u21a9","title":"Use GitHub Codespaces"},{"location":"4-codespaces/#use-github-codespaces","text":"You can run IS-IS labs in (free 1 ) GitHub codespaces ; all you need is a GitHub account: Create a new codespace for your IS-IS labs or connect to an existing codespace . Unless you\u2019re using GitHub codespaces with VScode (in which case you know what to do), your codespace opens in a new browser window with three tabs: Explorer (repository folders), Preview (starting with README), and Terminal.","title":"Use GitHub Codespaces"},{"location":"4-codespaces/#select-lab-devices","text":"The IS-IS labs repository uses FRRouting containers as the default device. To change the device settings, edit the defaults.yml file with vi or nano . It\u2019s best to use network devices with free-to-download container images: Device Device type to use in defaults.yml FRRouting frr Nokia SR Linux srlinux VyOS vyos Tip Start with the Configuring IS-IS on FRRouting exercise if you want to use the default settings but never worked with FRRouting before. Use FRRouting to use the 2 CPU/8 GB codespaces VM with more extensive labs. Codespaces have persistent storage; you can download and install other containers . To use containers that have to be downloaded from the vendors\u2019 website, download them onto your laptop, drag-and-drop them into the Folders , and install them like you would on a local netlab instance . You cannot run virtual machines in codespaces (yet?). This also precludes running VMs in virtual machines (the vrnetlab approach).","title":"Select Lab Devices"},{"location":"4-codespaces/#start-a-lab","text":"Once you have the codespaces up and running: Click on the desired lab exercise in the README.md preview window to select the exercise folder. Right-click on the exercise folder and select \u201c Open in Integrated Terminal \u201d to launch a bash session in the desired directory. Execute netlab up to start the lab. Expand the exercise folder in the Explorer tab. Right-click on the README.md file and select \u201c Open Preview \u201d to open the rendered version of the file. Click the link in the README.md file to get the exercise description in the preview pane. Connect to your devices with the netlab connect command executed in the Terminal pane.","title":"Start a Lab"},{"location":"4-codespaces/#cleanup-and-shutdown","text":"Finally, don\u2019t forget to shut down the lab with netlab down and stop your codespace after you\u2019re done: Click on the blue \u201c Codespaces \u201d button in the bottom-left corner of the browser window. Select \u201c Stop Current Codespace \u201d. You should also adjust idle timeout and default retention period in your codespaces settings . You get 120 free core hours per month or pay for more . \u21a9","title":"Cleanup and Shutdown"},{"location":"99-about/","text":"About the Project In 2023, I started the Open-Source BGP Labs project to recreate the labs I created in the early 1990s. As I posted a status update a year later , Henk Smit made an excellent suggestion : If you ever want to do something similar for IS-IS, I\u2019d be happy to help. I think it would already be helpful to just cover the basics of IS-IS. There is so little knowledge about IS-IS out there, that any new good resource would be awesome. As I was involved in a similar project in the 1990s, it wasn\u2019t hard to persuade me to start a similar series of \u201c IS-IS from rookie to hero \u201d lab exercises. Welcome to the Open-Source IS-IS Configuration Labs project. The project uses netlab 1 to set up the labs and FRRouting containers or a few other devices as external IS-IS routers. You can use whatever networking devices you wish to work on, and if they happen to be supported by netlab , you\u2019ll get lab topology and basic device configuration for each lab set up in seconds 2 . Most lab exercises using external devices include device configurations for the external routers for people who love wasting time with GUI. You\u2019ll find the lab topology files and initial device configurations in a GitHub repository , but you might explore the lab exercises first . As always, everything starts with a long wish list . I probably missed something important \u2013 please open an issue or a discussion , or (even better) become a contributor and submit a PR. When you happen to have a Hammer of Thor handy, everything looks like a nail waiting to be hit ;) \u21a9 Unless you love using resource hogs like Nexus OS, IOS XR, or some Junos variants. \u21a9","title":"About the Project"},{"location":"99-about/#about-the-project","text":"In 2023, I started the Open-Source BGP Labs project to recreate the labs I created in the early 1990s. As I posted a status update a year later , Henk Smit made an excellent suggestion : If you ever want to do something similar for IS-IS, I\u2019d be happy to help. I think it would already be helpful to just cover the basics of IS-IS. There is so little knowledge about IS-IS out there, that any new good resource would be awesome. As I was involved in a similar project in the 1990s, it wasn\u2019t hard to persuade me to start a similar series of \u201c IS-IS from rookie to hero \u201d lab exercises. Welcome to the Open-Source IS-IS Configuration Labs project. The project uses netlab 1 to set up the labs and FRRouting containers or a few other devices as external IS-IS routers. You can use whatever networking devices you wish to work on, and if they happen to be supported by netlab , you\u2019ll get lab topology and basic device configuration for each lab set up in seconds 2 . Most lab exercises using external devices include device configurations for the external routers for people who love wasting time with GUI. You\u2019ll find the lab topology files and initial device configurations in a GitHub repository , but you might explore the lab exercises first . As always, everything starts with a long wish list . I probably missed something important \u2013 please open an issue or a discussion , or (even better) become a contributor and submit a PR. When you happen to have a Hammer of Thor handy, everything looks like a nail waiting to be hit ;) \u21a9 Unless you love using resource hogs like Nexus OS, IOS XR, or some Junos variants. \u21a9","title":"About the Project"},{"location":"basic/","text":"Deploy IS-IS in Your Network The first set of the IS-IS labs focuses on the configuration, monitoring, and troubleshooting of basic IS-IS features: Work with FRRouting (optional) Start the IS-IS Routing for IPv4 Explore IS-IS Data Structures IS-IS on Point-to-Point Links Using IS-IS Metrics Dual-Stack (IPv4+IPv6) IS-IS Routing Optimize Simple IS-IS Deployments","title":"Overview"},{"location":"basic/#deploy-is-is-in-your-network","text":"The first set of the IS-IS labs focuses on the configuration, monitoring, and troubleshooting of basic IS-IS features: Work with FRRouting (optional) Start the IS-IS Routing for IPv4 Explore IS-IS Data Structures IS-IS on Point-to-Point Links Using IS-IS Metrics Dual-Stack (IPv4+IPv6) IS-IS Routing Optimize Simple IS-IS Deployments","title":"Deploy IS-IS in Your Network"},{"location":"basic/0-frrouting/","text":"Configuring IS-IS on FRRouting Most networking devices 1 use a configuration command line interface (CLI) to interact with the end-user. The CLI usually provides show commands to inspect the state of the device and a configuration mode that allows the user to configure the device. FRRouting is different. It\u2019s a suite of application-layer daemons running on Linux. Linux shell is used as the initial CLI. To configure a device that uses FRRouting without an extra CLI wrapper (like VyOS), you usually have to: Use standard Linux tools like ifupdown to configure the interfaces; Edit FRRouting configuration files to start routing protocol daemons Start FRRouting configuration shell from the Linux CLI. The Linux interfaces and IP addresses will be configured automatically if you start the IS-IS labs with the netlab up command. You will have to start the routing protocol daemons in the initial lab exercises if you plan to use FRRouting within virtual machines as the user routers, and you might have to execute show commands on Cumulus Linux or FRRouting acting as the external routers. You\u2019ll practice both in this lab exercise. Start the Lab Assuming you already set up your lab infrastructure : Change directory to basic/0-frrouting Execute netlab up to start a lab with two FRRouting virtual machines or containers (depending on your lab setup). R2 is preconfigured to run IS-IS; if you\u2019re using virtual machines, you might have to enable the IS-IS daemon on R1. Log into the devices ( r1 and r2 ) with the netlab connect command. Start the IS-IS Daemon Most network devices start routing daemons when you configure them through the configuration CLI or API. FRRouting is different. To start a routing daemon, you must enable the desired routing daemons in a configuration file and restart the top-level FRRouting process. You can check the FRR daemon processes running on your virtual machines with the sudo systemctl status frr.service command. It displays the running FRR daemons and the recent FRR logging messages, for example 2 : r2(bash)#sudo systemctl status frr.service \u25cf frr.service - FRRouting Loaded: loaded (/lib/systemd/system/frr.service; enabled; vendor preset: enabled) Active: active (running) since Wed 2024-07-17 17:09:27 UTC; 37s ago Docs: https://frrouting.readthedocs.io/en/latest/setup.html Process: 4051 ExecStart=/usr/lib/frr/frrinit.sh start (code=exited, status=0/SUCCESS) Main PID: 4071 (watchfrr) Status: \"FRR Operational\" Tasks: 1 (limit: 1049) Memory: 1.8M CGroup: /system.slice/frr.service \u2514\u25004071 /usr/lib/frr/watchfrr -d -F traditional zebra mgmtd isisd staticd Jul 17 17:09:27 r2 systemd[1]: Starting FRRouting... Jul 17 17:09:27 r2 frrinit.sh[4051]: * Starting watchfrr with command: ' /usr/lib/frr/watchfrr -d -F traditional zebra mgmtd > Jul 17 17:09:27 r2 watchfrr[4071]: [T83RR-8SM5G] watchfrr 10.0.1 starting: vty@0 Jul 17 17:09:27 r2 watchfrr[4071]: [QDG3Y-BY5TN] zebra state -> up : connect succeeded Jul 17 17:09:27 r2 watchfrr[4071]: [QDG3Y-BY5TN] mgmtd state -> up : connect succeeded Jul 17 17:09:27 r2 watchfrr[4071]: [QDG3Y-BY5TN] isisd state -> up : connect succeeded Jul 17 17:09:27 r2 watchfrr[4071]: [QDG3Y-BY5TN] staticd state -> up : connect succeeded Jul 17 17:09:27 r2 watchfrr[4071]: [KWE5Q-QNGFC] all daemons up, doing startup-complete notify Jul 17 17:09:27 r2 frrinit.sh[4051]: * Started watchfrr Jul 17 17:09:27 r2 systemd[1]: Started FRRouting. You cannot use the same command in FRRouting containers as they don\u2019t use systemd . The easiest way to find daemons in FRRouting containers is to use the ps -ef|grep frr command 3 . This is the printout you could get when the IS-IS daemon is already running: 1 root 0:00 /sbin/tini -- /usr/lib/frr/docker-start 7 root 0:00 {docker-start} /bin/bash /usr/lib/frr/docker-start 15 root 0:00 /usr/lib/frr/watchfrr zebra mgmtd isisd staticd 25 frr 0:00 /usr/lib/frr/zebra -d -F datacenter -A 127.0.0.1 -s 90000000 30 frr 0:00 /usr/lib/frr/mgmtd -d -F datacenter 32 frr 0:00 /usr/lib/frr/isisd -d -F datacenter -A 127.0.0.1 35 frr 0:00 /usr/lib/frr/staticd -d -F datacenter -A 127.0.0.1 366 root 0:00 grep frr The list of FRRouting daemons you want to enable is stored in the /etc/frr/daemons file. To enable the FRRouting IS-IS daemon, you have to: Add the isisd=yes line to the /etc/frr/daemons file 4 . Restart FRRouting with the sudo systemctl restart frr.service command (see also: using sudo ) Warning You cannot change the FRR daemons in FRR containers. Restarting FRR would kill the container. netlab takes care of that and enables all the daemons necessary to complete the lab exercises. Restarting FRR daemons wipes out the current (running) configuration. If you want to retain it, save it to the startup configuration with the vtysh write command. The write command saves the running configuration (that you can inspect with show running-config ) into the /etc/frr/frr.conf file. However, the show startup-config 5 does not display the content of that file. Exit vtysh and use the more /etc/frr/frr.conf command 6 to inspect it. You could add the required line to the FRRouting daemons file with any text editor 7 or use the following trick: Use sudo bash to start another Linux shell as the root user Use the echo command with output redirection to add a line to the /etc/frr/daemons file. rtr(bash)#sudo bash root@rtr:/# echo 'isis=yes' >>/etc/frr/daemons root@rtr:/# exit After enabling the IS-IS daemon and restarting FRR, you should see the isisd process in the ps -ef printout or the IS-IS daemon mentioned in the sudo systemctl status frr.service printout. Work with the FRRouting CLI FRRouting suite includes a virtual shell ( vtysh ) closely resembling industry-standard CLI 8 . It has to be started from the Linux command line with the vtysh command. The vtysh CLI has to run as the root user unless you change the FRR-related permissions to allow a regular user to use it. The usual command to start the vtysh is thus sudo vtysh (but see also To Sudo Or Not to Sudo ). r2(bash)#sudo vtysh Hello, this is FRRouting (version 9.1_git). Copyright 1996-2005 Kunihiro Ishiguro, et al. r2# Once you started vtysh , you can execute show commands to inspect the device state, for example: r2(bash)#sudo vtysh Hello, this is FRRouting (version 9.1_git). Copyright 1996-2005 Kunihiro Ishiguro, et al. r2# show ip route Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure C>* 10.0.0.2/32 is directly connected, lo, 00:02:26 C>* 10.1.0.0/30 is directly connected, eth1, 00:02:26 You can also use the --show option of the netlab connect command to execute a single command on a FRR/Cumulus Linux device[^UQ]. For example, to inspect the IS-IS topology database, use netlab connect --show isis database : $ netlab connect r2 --show isis database Connecting to container clab-frrouting-r2, executing vtysh -c \"show isis database\" Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r2.00-00 * 81 0x00000001 0xec86 1489 0/0/0 1 LSPs To configure FRRouting daemons, use the configure vtysh command and enter configuration commands similar to those you\u2019d use on Cisco IOS or Arista EOS: r2(bash)#vtysh Hello, this is FRRouting (version 9.1_git). Copyright 1996-2005 Kunihiro Ishiguro, et al. r2# configure r2(config)# router isis Gandalf r2(config-router)# To Sudo Or Not to Sudo The vtysh usually has to run as the root user, so you should start it with the sudo vtysh command. Unfortunately, things are never as simple as they look in the Linux world: When using SSH, you log into Cumulus Linux or FRRouting virtual machines as a regular user (user vagrant in netlab -created labs) and have to use the sudo command to start vtysh . Cumulus Linux and FRR containers run as the root user, and you connect to them as the root user with the docker exec or netlab connect commands 9 . When working with containers, you can start vtysh without using the sudo command. You can execute sudo vtysh as a root user on Cumulus Linux containers but not within an FRR container. The FRR container does not include the sudo command. Long story short: Use sudo vtysh whenever possible to burn it into your muscle memory. Use vtysh if you use FRRouting containers as the lab devices. Using Output Filters Unlike many other network operating systems, FRRouting vtysh does not have output filters. You probably don\u2019t need them as you\u2019ll be running FRR on top of a Unix-like operating system that supports pipes, but it might be a bit convoluted to use vtysh in a pipe. To use the vtysh output in a pipe, you have to execute vtysh and get the results of a show command in a single command: You could use sudo vtysh -c 'show command' when you\u2019re in the bash shell of a lab device, for example: r2(bash)#vtysh -c 'show isis database'|grep r2 r2.00-00 * 81 0x00000001 0xec86 1302 0/0/0 Alternatively, you could use the netlab connect --show command to execute a vtysh show command on a lab device: $ netlab connect r2 -q --show isis database|grep r2 r2.00-00 * 81 0x00000001 0xec86 1286 0/0/0 Tip Use netlab connect --quiet --show to omit the Connecting to... message. The following table contains a mapping between common network operating system filters and Linux CLI commands: NOS filter Linux CLI command include grep exclude grep -v begin grep -A 10000 10 end grep -B 10000 section no equivalent Including devices based on Linux like Arista EOS, Cisco Nexus OS, or Nokia SR Linux \u21a9 The printout details depend on the Linux and FRR versions, but you\u2019ll always be able to determine whether the IS-IS process is running. \u21a9 You can use the same command with FRRouting running in a virtual machine. \u21a9 See Configuring FRRouting Cumulus Linux documentation for more details. \u21a9 At least on FRRouting version 9.1 and earlier \u21a9 You might have to prefix it with sudo \u21a9 vi is available in Cumulus Linux containers. vi and nano are available in Cumulus Linux and FRR virtual machines. \u21a9 An euphemism for Cisco IOS CLI that is used when you try to avoid nasty encounters with Cisco\u2019s legal team. \u21a9 When in doubt, use the whoami command. \u21a9 The \u201810000\u2019 parameter specifies the number of lines after the match. Increase it for very long printouts ;) \u21a9","title":"Configuring IS-IS on FRRouting"},{"location":"basic/0-frrouting/#configuring-is-is-on-frrouting","text":"Most networking devices 1 use a configuration command line interface (CLI) to interact with the end-user. The CLI usually provides show commands to inspect the state of the device and a configuration mode that allows the user to configure the device. FRRouting is different. It\u2019s a suite of application-layer daemons running on Linux. Linux shell is used as the initial CLI. To configure a device that uses FRRouting without an extra CLI wrapper (like VyOS), you usually have to: Use standard Linux tools like ifupdown to configure the interfaces; Edit FRRouting configuration files to start routing protocol daemons Start FRRouting configuration shell from the Linux CLI. The Linux interfaces and IP addresses will be configured automatically if you start the IS-IS labs with the netlab up command. You will have to start the routing protocol daemons in the initial lab exercises if you plan to use FRRouting within virtual machines as the user routers, and you might have to execute show commands on Cumulus Linux or FRRouting acting as the external routers. You\u2019ll practice both in this lab exercise.","title":"Configuring IS-IS on FRRouting"},{"location":"basic/0-frrouting/#start-the-lab","text":"Assuming you already set up your lab infrastructure : Change directory to basic/0-frrouting Execute netlab up to start a lab with two FRRouting virtual machines or containers (depending on your lab setup). R2 is preconfigured to run IS-IS; if you\u2019re using virtual machines, you might have to enable the IS-IS daemon on R1. Log into the devices ( r1 and r2 ) with the netlab connect command.","title":"Start the Lab"},{"location":"basic/0-frrouting/#daemon","text":"Most network devices start routing daemons when you configure them through the configuration CLI or API. FRRouting is different. To start a routing daemon, you must enable the desired routing daemons in a configuration file and restart the top-level FRRouting process. You can check the FRR daemon processes running on your virtual machines with the sudo systemctl status frr.service command. It displays the running FRR daemons and the recent FRR logging messages, for example 2 : r2(bash)#sudo systemctl status frr.service \u25cf frr.service - FRRouting Loaded: loaded (/lib/systemd/system/frr.service; enabled; vendor preset: enabled) Active: active (running) since Wed 2024-07-17 17:09:27 UTC; 37s ago Docs: https://frrouting.readthedocs.io/en/latest/setup.html Process: 4051 ExecStart=/usr/lib/frr/frrinit.sh start (code=exited, status=0/SUCCESS) Main PID: 4071 (watchfrr) Status: \"FRR Operational\" Tasks: 1 (limit: 1049) Memory: 1.8M CGroup: /system.slice/frr.service \u2514\u25004071 /usr/lib/frr/watchfrr -d -F traditional zebra mgmtd isisd staticd Jul 17 17:09:27 r2 systemd[1]: Starting FRRouting... Jul 17 17:09:27 r2 frrinit.sh[4051]: * Starting watchfrr with command: ' /usr/lib/frr/watchfrr -d -F traditional zebra mgmtd > Jul 17 17:09:27 r2 watchfrr[4071]: [T83RR-8SM5G] watchfrr 10.0.1 starting: vty@0 Jul 17 17:09:27 r2 watchfrr[4071]: [QDG3Y-BY5TN] zebra state -> up : connect succeeded Jul 17 17:09:27 r2 watchfrr[4071]: [QDG3Y-BY5TN] mgmtd state -> up : connect succeeded Jul 17 17:09:27 r2 watchfrr[4071]: [QDG3Y-BY5TN] isisd state -> up : connect succeeded Jul 17 17:09:27 r2 watchfrr[4071]: [QDG3Y-BY5TN] staticd state -> up : connect succeeded Jul 17 17:09:27 r2 watchfrr[4071]: [KWE5Q-QNGFC] all daemons up, doing startup-complete notify Jul 17 17:09:27 r2 frrinit.sh[4051]: * Started watchfrr Jul 17 17:09:27 r2 systemd[1]: Started FRRouting. You cannot use the same command in FRRouting containers as they don\u2019t use systemd . The easiest way to find daemons in FRRouting containers is to use the ps -ef|grep frr command 3 . This is the printout you could get when the IS-IS daemon is already running: 1 root 0:00 /sbin/tini -- /usr/lib/frr/docker-start 7 root 0:00 {docker-start} /bin/bash /usr/lib/frr/docker-start 15 root 0:00 /usr/lib/frr/watchfrr zebra mgmtd isisd staticd 25 frr 0:00 /usr/lib/frr/zebra -d -F datacenter -A 127.0.0.1 -s 90000000 30 frr 0:00 /usr/lib/frr/mgmtd -d -F datacenter 32 frr 0:00 /usr/lib/frr/isisd -d -F datacenter -A 127.0.0.1 35 frr 0:00 /usr/lib/frr/staticd -d -F datacenter -A 127.0.0.1 366 root 0:00 grep frr The list of FRRouting daemons you want to enable is stored in the /etc/frr/daemons file. To enable the FRRouting IS-IS daemon, you have to: Add the isisd=yes line to the /etc/frr/daemons file 4 . Restart FRRouting with the sudo systemctl restart frr.service command (see also: using sudo ) Warning You cannot change the FRR daemons in FRR containers. Restarting FRR would kill the container. netlab takes care of that and enables all the daemons necessary to complete the lab exercises. Restarting FRR daemons wipes out the current (running) configuration. If you want to retain it, save it to the startup configuration with the vtysh write command. The write command saves the running configuration (that you can inspect with show running-config ) into the /etc/frr/frr.conf file. However, the show startup-config 5 does not display the content of that file. Exit vtysh and use the more /etc/frr/frr.conf command 6 to inspect it. You could add the required line to the FRRouting daemons file with any text editor 7 or use the following trick: Use sudo bash to start another Linux shell as the root user Use the echo command with output redirection to add a line to the /etc/frr/daemons file. rtr(bash)#sudo bash root@rtr:/# echo 'isis=yes' >>/etc/frr/daemons root@rtr:/# exit After enabling the IS-IS daemon and restarting FRR, you should see the isisd process in the ps -ef printout or the IS-IS daemon mentioned in the sudo systemctl status frr.service printout.","title":"Start the IS-IS Daemon"},{"location":"basic/0-frrouting/#vtysh","text":"FRRouting suite includes a virtual shell ( vtysh ) closely resembling industry-standard CLI 8 . It has to be started from the Linux command line with the vtysh command. The vtysh CLI has to run as the root user unless you change the FRR-related permissions to allow a regular user to use it. The usual command to start the vtysh is thus sudo vtysh (but see also To Sudo Or Not to Sudo ). r2(bash)#sudo vtysh Hello, this is FRRouting (version 9.1_git). Copyright 1996-2005 Kunihiro Ishiguro, et al. r2# Once you started vtysh , you can execute show commands to inspect the device state, for example: r2(bash)#sudo vtysh Hello, this is FRRouting (version 9.1_git). Copyright 1996-2005 Kunihiro Ishiguro, et al. r2# show ip route Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure C>* 10.0.0.2/32 is directly connected, lo, 00:02:26 C>* 10.1.0.0/30 is directly connected, eth1, 00:02:26 You can also use the --show option of the netlab connect command to execute a single command on a FRR/Cumulus Linux device[^UQ]. For example, to inspect the IS-IS topology database, use netlab connect --show isis database : $ netlab connect r2 --show isis database Connecting to container clab-frrouting-r2, executing vtysh -c \"show isis database\" Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r2.00-00 * 81 0x00000001 0xec86 1489 0/0/0 1 LSPs To configure FRRouting daemons, use the configure vtysh command and enter configuration commands similar to those you\u2019d use on Cisco IOS or Arista EOS: r2(bash)#vtysh Hello, this is FRRouting (version 9.1_git). Copyright 1996-2005 Kunihiro Ishiguro, et al. r2# configure r2(config)# router isis Gandalf r2(config-router)#","title":"Work with the FRRouting CLI"},{"location":"basic/0-frrouting/#sudo","text":"The vtysh usually has to run as the root user, so you should start it with the sudo vtysh command. Unfortunately, things are never as simple as they look in the Linux world: When using SSH, you log into Cumulus Linux or FRRouting virtual machines as a regular user (user vagrant in netlab -created labs) and have to use the sudo command to start vtysh . Cumulus Linux and FRR containers run as the root user, and you connect to them as the root user with the docker exec or netlab connect commands 9 . When working with containers, you can start vtysh without using the sudo command. You can execute sudo vtysh as a root user on Cumulus Linux containers but not within an FRR container. The FRR container does not include the sudo command. Long story short: Use sudo vtysh whenever possible to burn it into your muscle memory. Use vtysh if you use FRRouting containers as the lab devices.","title":"To Sudo Or Not to Sudo"},{"location":"basic/0-frrouting/#using-output-filters","text":"Unlike many other network operating systems, FRRouting vtysh does not have output filters. You probably don\u2019t need them as you\u2019ll be running FRR on top of a Unix-like operating system that supports pipes, but it might be a bit convoluted to use vtysh in a pipe. To use the vtysh output in a pipe, you have to execute vtysh and get the results of a show command in a single command: You could use sudo vtysh -c 'show command' when you\u2019re in the bash shell of a lab device, for example: r2(bash)#vtysh -c 'show isis database'|grep r2 r2.00-00 * 81 0x00000001 0xec86 1302 0/0/0 Alternatively, you could use the netlab connect --show command to execute a vtysh show command on a lab device: $ netlab connect r2 -q --show isis database|grep r2 r2.00-00 * 81 0x00000001 0xec86 1286 0/0/0 Tip Use netlab connect --quiet --show to omit the Connecting to... message. The following table contains a mapping between common network operating system filters and Linux CLI commands: NOS filter Linux CLI command include grep exclude grep -v begin grep -A 10000 10 end grep -B 10000 section no equivalent Including devices based on Linux like Arista EOS, Cisco Nexus OS, or Nokia SR Linux \u21a9 The printout details depend on the Linux and FRR versions, but you\u2019ll always be able to determine whether the IS-IS process is running. \u21a9 You can use the same command with FRRouting running in a virtual machine. \u21a9 See Configuring FRRouting Cumulus Linux documentation for more details. \u21a9 At least on FRRouting version 9.1 and earlier \u21a9 You might have to prefix it with sudo \u21a9 vi is available in Cumulus Linux containers. vi and nano are available in Cumulus Linux and FRR virtual machines. \u21a9 An euphemism for Cisco IOS CLI that is used when you try to avoid nasty encounters with Cisco\u2019s legal team. \u21a9 When in doubt, use the whoami command. \u21a9 The \u201810000\u2019 parameter specifies the number of lines after the match. Increase it for very long printouts ;) \u21a9","title":"Using Output Filters"},{"location":"basic/1-simple-ipv4/","text":"Configure IS-IS Routing for IPv4 We\u2019ll start with the simplest possible scenario: we\u2019re adding a new router to an existing IS-IS network and have to configure IS-IS routing on it. Device Requirements Use any netlab -supported device for the router you\u2019ll be configuring. Use a device supported by the netlab IS-IS configuration module for X1 and X2 (default: FRRouting virtual machines or containers). You can do automated lab validation when using FRRouting on the external routers. Starting the Lab Assuming you already set up your lab infrastructure : Change directory to basic/1-simple-ipv4 Execute netlab up Log into your device (RTR) with netlab connect rtr and verify that the IP addresses are configured on all its interfaces. You\u2019ll get a lab with IPv4 addresses configured on all interfaces and IS-IS routing configured on X1 and X2 but not RTR. Configuration Tasks The minimal IS-IS configuration process has three or four steps: Start an IS-IS routing process with a global configuration command similar to router isis . You might have to specify a routing process tag \u2013 a string that identifies the IS-IS instance in other configuration commands. Assign a CLNS address (NET \u2013 Network Entity Title) to the IS-IS routing process with a routing configuration command similar to net address ( more details ). The NET assigned to your router is 49.0001.0000.0000.0042.00 Enable IS-IS routing for IPv4 on individual interfaces with an interface configuration command similar to ip router isis tag or isis enable tag . Some devices also want you to configure which address families (IPv4 or IPv6) you want to route with IS-IS. The router configuration command to do that is often address-family ipv4 . Tip If you\u2019re using FRRouting on RTR, you might have to enable the IS-IS daemon first. You\u2019ll find more details in the Configuring IS-IS on FRRouting lab. Unfortunately, most IS-IS implementations are ancient and use defaults that might have made sense decades ago. You should also configure the following parameters 1 : Configure the links with two nodes attached to them as point-to-point links with an interface configuration command similar to isis network point-to-point (more details in IS-IS on Point-to-Point Links ) Configure your router to be a Level-2-Only router with the router configuration command similar to is-type level-2-only 2 (more details in Optimize Simple IS-IS Deployments ). On some devices, you\u2019ll have to configure wide metrics with a router configuration command similar to metric-style wide 4 (more details in Using IS-IS Metrics ). Finally, you might have to configure the standard point-to-point three-way handshake on Cisco IOSv 3 . The interface configuration command to do that is \u200cisis three-way-handshake ietf . Finally, make sure your configuration includes these settings: Logging of adjacency changes (typically configured with a router configuration command like log-adjacency-changes ) Dynamic mapping of NETs to hostnames (usually enabled; sometimes you can\u2019t turn it off) Validation You can use the netlab validate command if you\u2019re using netlab release 1.8.4 or later and run FRRouting on the external routers. This is the printout you should get after completing the lab exercise: You should also do basic manual validation on your device: Inspect IS-IS adjacencies with a command similar to show isis neighbors or show isis adjacency . Your router should have level-2 adjacencies with X1 and X2; this is the printout you should get on FRRouting: IS-IS neighbors (FRRouting) rtr# show isis neighbor Area SomeTag: System Id Interface L State Holdtime SNPA x1 eth1 2 Up 29 2020.2020.2020 x2 eth2 2 Up 30 2020.2020.2020 If your device has commands similar to show isis topology , show isis network topology , or show isis route , use them to display the shortest paths to other routers and the best IS-IS paths. IS-IS network topology (first part of the printout) and IPv4 routing table on FRRouting rtr# show isis route Area SomeTag: IS-IS paths to level-2 routers that speak IP Vertex Type Metric Next-Hop Interface Parent rtr 10.1.0.0/30 IP internal 0 rtr(4) 10.1.0.4/30 IP internal 0 rtr(4) x1 TE-IS 10 x1 eth1 rtr(4) x2 TE-IS 10 x2 eth2 rtr(4) 10.0.0.2/32 IP TE 20 x1 eth1 x1(4) 10.1.0.0/30 IP TE 20 x1 eth1 x1(4) 10.0.0.3/32 IP TE 20 x2 eth2 x2(4) 10.1.0.4/30 IP TE 20 x2 eth2 x2(4) IS-IS L2 IPv4 routing table: Prefix Metric Interface Nexthop Label(s) ---------------------------------------------------- 10.0.0.2/32 20 eth1 10.1.0.2 - 10.0.0.3/32 20 eth2 10.1.0.6 - 10.1.0.0/30 20 eth1 10.1.0.2 - 10.1.0.4/30 20 eth2 10.1.0.6 - IS-IS network topology on Arista EOS rtr>show isis network topology IS-IS Instance: SomeTag VRF: default IS-IS paths to level-2 routers System Id Metric IA Metric Next-Hop Interface SNPA x1 10 0 x1 Ethernet1 P2P x2 10 0 x2 Ethernet2 P2P Finally, inspect the IP routing table and verify that you can see three loopback prefixes (10.0.0.1/32 through 10.0.0.3/32). This is the printout you should get on FRRouting IS-IS routes in the IPv4 routing table (FRRouting) rtr# show ip route isis Codes: K - kernel route, C - connected, L - local, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure I>* 10.0.0.2/32 [115/20] via 10.1.0.2, eth1, weight 1, 00:00:47 I>* 10.0.0.3/32 [115/20] via 10.1.0.6, eth2, weight 1, 00:00:18 I 10.1.0.0/30 [115/20] via 10.1.0.2, eth1 inactive, weight 1, 00:00:47 I 10.1.0.4/30 [115/20] via 10.1.0.6, eth2 inactive, weight 1, 00:00:18 FRRouting uses the IP routing table as the repository of all routes , not just the best routes , so it displays the inactive IS-IS routes. Other network devices, for example Arista EOS 5 , display just the active IS-IS routes: IS-IS routes in IPv4 routing table on Arista EOS rtr#show ip route isis detail|begin Priority Priority Codes: PL - Priority low, PM - Priority medium, PH - Priority high I L2 10.0.0.2/32 [115/20] via 10.1.0.2, Ethernet1 rtr -> x1 I L2 10.0.0.3/32 [115/20] via 10.1.0.6, Ethernet2 rtr -> x2 Next: Explore IS-IS Data Structures . That lab uses the same topology and device configurations, so you can keep going without restarting the lab. Background Information IS-IS was designed to be the routing protocol for the ISO/OSI protocol stack. Its name is derived from ISO terminology: IS stands for Intermediate System (the device also known as router , gateway or layer-3 switch ). Thus, IS-IS is the protocol that runs between Intermediate Systems (in other words, the router-to-router protocol). While ISO designed IS-IS to be used with CLNP, its data structures (everything is CLV 6 -based) made it easy to extend, and so IETF quickly specified how to use IS-IS for IPv4 and (later) IPv6 routing. IS-IS does not run on top of another layer-3 protocol like OSPF or BGP run on top of IP; it is an independent protocol at layer-3 and uses a dedicated 802.1 SAP ( more details ). You cannot use the standard IP access control mechanisms with IS-IS; on the other hand, it\u2019s impossible to spoof IS-IS messages if the intruder does not have access to the underlying layer-2 infrastructure. IS-IS addressing follows the OSI addressing principles. Network addresses (Network Service Access Points \u2013 NSAPs) are assigned to nodes , not interfaces . OSI protocol suite used variable-length addresses, and according to the ( poorly formatted copy of ) IS-IS specifications, the NET is split into three parts (you\u2019ll find more details in RFC 1237 ): +--------+-----------+----+ | Area | System-ID | NS | +--------+-----------+----+ The NSAP Selector (the last byte) specifies the software entity on the node that should receive the packet (similar to the TCP/UDP/OSPF protocol type within the IPv4 header). IS-IS uses NSAP selector value zero and calls the resulting address Network Entity Title (NET). Thus, the last byte of NET always has to be zero. The System ID (node address within an area, similar to the subnet part of an IP address) is one to eight bytes long. Subsequent parts of IS-IS specification assume a 6-byte System ID (12 hexadecimal characters), and that\u2019s what all implementations use. The Area is whatever is left on the left-hand side of the NET after you take away the rightmost seven bytes. The NET is usually formatted as a hexadecimal string (two hexadecimal digits per byte) with two-byte portions (four hexadecimal digits) separated by a dot. The placement of dots is a bit counterintuitive: The rightmost dot has to be between the System ID and NSAP Selector. Subsequent dots have to be four characters left of the previous dot, resulting in two dots within the System ID and a dot between the node System ID and the IS-IS area. For example, the NET we used in this lab ( 49000100000000004200 )has to be written as 49.0001.0000.0000.0042.00 . The area address could have any length 7 as long as it\u2019s specified as a whole number of bytes (an even number of digits). IS-IS doesn\u2019t care about the contents of the area address. If two routers have the value in that part of the NET, they belong to the same area; if not, they don\u2019t. Finally, other ISO standards define the meaning of the leftmost part of a network address (NSAP). The first (leftmost) byte is the Authority and Format Identifier (AFI), and the value 49 indicates private address space (similar to RFC 1918 IPv4 address space) (see RFC 1629 for more details). Using two bytes as the area ID usually makes sense, and that\u2019s why most NETs you find in online examples start with 49.0001 ;) 8 Reference Information Lab Wiring Origin Device Origin Port Destination Device Destination Port rtr Ethernet1 x1 eth1 rtr Ethernet2 x2 eth1 Note: The interface names depend on the devices you use in the lab. The printout was generated with Arista EOS running on RTR and FRRouting running on X1 and X2. Lab Addressing Node/Interface IPv4 Address IPv6 Address Description rtr 10.0.0.1/32 Loopback Ethernet1 10.1.0.1/30 rtr -> x1 Ethernet2 10.1.0.5/30 rtr -> x2 x1 10.0.0.2/32 Loopback eth1 10.1.0.2/30 x1 -> rtr x2 10.0.0.3/32 Loopback eth1 10.1.0.6/30 x2 -> rtr Trust me for the moment; we\u2019ll discuss them in great detail in subsequent lab exercises. \u21a9 You don\u2019t have to configure the interface circuit-type once you configured the device to be a level-2-only router. A level-2-only router will never send level-1 hellos. \u21a9 The IOSv image on which I had to do that was obviously ancient but still 13 years younger than the RFC 3373 that standardized the three-way handshake. \u21a9 As crazy as it sounds, some devices still use the ancient narrow metrics as the default setting 20 years after the wide metrics were defined in RFC 3784 . \u21a9 The detail option of the show ip route command includes the interface description, and the |begin Priority output filter removes the legend. \u21a9 Code/Length/Value: every bit of information starts with a code (one byte), followed by length (one byte) and the actual value. This encoding approach is more commonly called TLV (Type/Length/Value). \u21a9 There must be some upper limit. \u21a9 In the early days of IS-IS, when people still believed that the OSI protocol stack (with CLNS at layer-3) might win the protocol wars, service providers used official NSAP prefixes allocated by government agencies (see RFC 1237 for details ). CLNS is long gone, and we only need NETs to address IS-IS routers. Area 49.0001 is good enough for that. You can also use Area 51 if you\u2019re so inclined (yes, it works; IS-IS does not care about the contents of the area field). \u21a9","title":"Configure IS-IS Routing for IPv4"},{"location":"basic/1-simple-ipv4/#configure-is-is-routing-for-ipv4","text":"We\u2019ll start with the simplest possible scenario: we\u2019re adding a new router to an existing IS-IS network and have to configure IS-IS routing on it.","title":"Configure IS-IS Routing for IPv4"},{"location":"basic/1-simple-ipv4/#device-requirements","text":"Use any netlab -supported device for the router you\u2019ll be configuring. Use a device supported by the netlab IS-IS configuration module for X1 and X2 (default: FRRouting virtual machines or containers). You can do automated lab validation when using FRRouting on the external routers.","title":"Device Requirements"},{"location":"basic/1-simple-ipv4/#starting-the-lab","text":"Assuming you already set up your lab infrastructure : Change directory to basic/1-simple-ipv4 Execute netlab up Log into your device (RTR) with netlab connect rtr and verify that the IP addresses are configured on all its interfaces. You\u2019ll get a lab with IPv4 addresses configured on all interfaces and IS-IS routing configured on X1 and X2 but not RTR.","title":"Starting the Lab"},{"location":"basic/1-simple-ipv4/#configuration-tasks","text":"The minimal IS-IS configuration process has three or four steps: Start an IS-IS routing process with a global configuration command similar to router isis . You might have to specify a routing process tag \u2013 a string that identifies the IS-IS instance in other configuration commands. Assign a CLNS address (NET \u2013 Network Entity Title) to the IS-IS routing process with a routing configuration command similar to net address ( more details ). The NET assigned to your router is 49.0001.0000.0000.0042.00 Enable IS-IS routing for IPv4 on individual interfaces with an interface configuration command similar to ip router isis tag or isis enable tag . Some devices also want you to configure which address families (IPv4 or IPv6) you want to route with IS-IS. The router configuration command to do that is often address-family ipv4 . Tip If you\u2019re using FRRouting on RTR, you might have to enable the IS-IS daemon first. You\u2019ll find more details in the Configuring IS-IS on FRRouting lab. Unfortunately, most IS-IS implementations are ancient and use defaults that might have made sense decades ago. You should also configure the following parameters 1 : Configure the links with two nodes attached to them as point-to-point links with an interface configuration command similar to isis network point-to-point (more details in IS-IS on Point-to-Point Links ) Configure your router to be a Level-2-Only router with the router configuration command similar to is-type level-2-only 2 (more details in Optimize Simple IS-IS Deployments ). On some devices, you\u2019ll have to configure wide metrics with a router configuration command similar to metric-style wide 4 (more details in Using IS-IS Metrics ). Finally, you might have to configure the standard point-to-point three-way handshake on Cisco IOSv 3 . The interface configuration command to do that is \u200cisis three-way-handshake ietf . Finally, make sure your configuration includes these settings: Logging of adjacency changes (typically configured with a router configuration command like log-adjacency-changes ) Dynamic mapping of NETs to hostnames (usually enabled; sometimes you can\u2019t turn it off)","title":"Configuration Tasks"},{"location":"basic/1-simple-ipv4/#validation","text":"You can use the netlab validate command if you\u2019re using netlab release 1.8.4 or later and run FRRouting on the external routers. This is the printout you should get after completing the lab exercise: You should also do basic manual validation on your device: Inspect IS-IS adjacencies with a command similar to show isis neighbors or show isis adjacency . Your router should have level-2 adjacencies with X1 and X2; this is the printout you should get on FRRouting: IS-IS neighbors (FRRouting) rtr# show isis neighbor Area SomeTag: System Id Interface L State Holdtime SNPA x1 eth1 2 Up 29 2020.2020.2020 x2 eth2 2 Up 30 2020.2020.2020 If your device has commands similar to show isis topology , show isis network topology , or show isis route , use them to display the shortest paths to other routers and the best IS-IS paths. IS-IS network topology (first part of the printout) and IPv4 routing table on FRRouting rtr# show isis route Area SomeTag: IS-IS paths to level-2 routers that speak IP Vertex Type Metric Next-Hop Interface Parent rtr 10.1.0.0/30 IP internal 0 rtr(4) 10.1.0.4/30 IP internal 0 rtr(4) x1 TE-IS 10 x1 eth1 rtr(4) x2 TE-IS 10 x2 eth2 rtr(4) 10.0.0.2/32 IP TE 20 x1 eth1 x1(4) 10.1.0.0/30 IP TE 20 x1 eth1 x1(4) 10.0.0.3/32 IP TE 20 x2 eth2 x2(4) 10.1.0.4/30 IP TE 20 x2 eth2 x2(4) IS-IS L2 IPv4 routing table: Prefix Metric Interface Nexthop Label(s) ---------------------------------------------------- 10.0.0.2/32 20 eth1 10.1.0.2 - 10.0.0.3/32 20 eth2 10.1.0.6 - 10.1.0.0/30 20 eth1 10.1.0.2 - 10.1.0.4/30 20 eth2 10.1.0.6 - IS-IS network topology on Arista EOS rtr>show isis network topology IS-IS Instance: SomeTag VRF: default IS-IS paths to level-2 routers System Id Metric IA Metric Next-Hop Interface SNPA x1 10 0 x1 Ethernet1 P2P x2 10 0 x2 Ethernet2 P2P Finally, inspect the IP routing table and verify that you can see three loopback prefixes (10.0.0.1/32 through 10.0.0.3/32). This is the printout you should get on FRRouting IS-IS routes in the IPv4 routing table (FRRouting) rtr# show ip route isis Codes: K - kernel route, C - connected, L - local, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure I>* 10.0.0.2/32 [115/20] via 10.1.0.2, eth1, weight 1, 00:00:47 I>* 10.0.0.3/32 [115/20] via 10.1.0.6, eth2, weight 1, 00:00:18 I 10.1.0.0/30 [115/20] via 10.1.0.2, eth1 inactive, weight 1, 00:00:47 I 10.1.0.4/30 [115/20] via 10.1.0.6, eth2 inactive, weight 1, 00:00:18 FRRouting uses the IP routing table as the repository of all routes , not just the best routes , so it displays the inactive IS-IS routes. Other network devices, for example Arista EOS 5 , display just the active IS-IS routes: IS-IS routes in IPv4 routing table on Arista EOS rtr#show ip route isis detail|begin Priority Priority Codes: PL - Priority low, PM - Priority medium, PH - Priority high I L2 10.0.0.2/32 [115/20] via 10.1.0.2, Ethernet1 rtr -> x1 I L2 10.0.0.3/32 [115/20] via 10.1.0.6, Ethernet2 rtr -> x2 Next: Explore IS-IS Data Structures . That lab uses the same topology and device configurations, so you can keep going without restarting the lab.","title":"Validation"},{"location":"basic/1-simple-ipv4/#bg","text":"IS-IS was designed to be the routing protocol for the ISO/OSI protocol stack. Its name is derived from ISO terminology: IS stands for Intermediate System (the device also known as router , gateway or layer-3 switch ). Thus, IS-IS is the protocol that runs between Intermediate Systems (in other words, the router-to-router protocol). While ISO designed IS-IS to be used with CLNP, its data structures (everything is CLV 6 -based) made it easy to extend, and so IETF quickly specified how to use IS-IS for IPv4 and (later) IPv6 routing. IS-IS does not run on top of another layer-3 protocol like OSPF or BGP run on top of IP; it is an independent protocol at layer-3 and uses a dedicated 802.1 SAP ( more details ). You cannot use the standard IP access control mechanisms with IS-IS; on the other hand, it\u2019s impossible to spoof IS-IS messages if the intruder does not have access to the underlying layer-2 infrastructure. IS-IS addressing follows the OSI addressing principles. Network addresses (Network Service Access Points \u2013 NSAPs) are assigned to nodes , not interfaces . OSI protocol suite used variable-length addresses, and according to the ( poorly formatted copy of ) IS-IS specifications, the NET is split into three parts (you\u2019ll find more details in RFC 1237 ): +--------+-----------+----+ | Area | System-ID | NS | +--------+-----------+----+ The NSAP Selector (the last byte) specifies the software entity on the node that should receive the packet (similar to the TCP/UDP/OSPF protocol type within the IPv4 header). IS-IS uses NSAP selector value zero and calls the resulting address Network Entity Title (NET). Thus, the last byte of NET always has to be zero. The System ID (node address within an area, similar to the subnet part of an IP address) is one to eight bytes long. Subsequent parts of IS-IS specification assume a 6-byte System ID (12 hexadecimal characters), and that\u2019s what all implementations use. The Area is whatever is left on the left-hand side of the NET after you take away the rightmost seven bytes. The NET is usually formatted as a hexadecimal string (two hexadecimal digits per byte) with two-byte portions (four hexadecimal digits) separated by a dot. The placement of dots is a bit counterintuitive: The rightmost dot has to be between the System ID and NSAP Selector. Subsequent dots have to be four characters left of the previous dot, resulting in two dots within the System ID and a dot between the node System ID and the IS-IS area. For example, the NET we used in this lab ( 49000100000000004200 )has to be written as 49.0001.0000.0000.0042.00 . The area address could have any length 7 as long as it\u2019s specified as a whole number of bytes (an even number of digits). IS-IS doesn\u2019t care about the contents of the area address. If two routers have the value in that part of the NET, they belong to the same area; if not, they don\u2019t. Finally, other ISO standards define the meaning of the leftmost part of a network address (NSAP). The first (leftmost) byte is the Authority and Format Identifier (AFI), and the value 49 indicates private address space (similar to RFC 1918 IPv4 address space) (see RFC 1629 for more details). Using two bytes as the area ID usually makes sense, and that\u2019s why most NETs you find in online examples start with 49.0001 ;) 8","title":"Background Information"},{"location":"basic/1-simple-ipv4/#reference-information","text":"","title":"Reference Information"},{"location":"basic/1-simple-ipv4/#lab-wiring","text":"Origin Device Origin Port Destination Device Destination Port rtr Ethernet1 x1 eth1 rtr Ethernet2 x2 eth1 Note: The interface names depend on the devices you use in the lab. The printout was generated with Arista EOS running on RTR and FRRouting running on X1 and X2.","title":"Lab Wiring"},{"location":"basic/1-simple-ipv4/#lab-addressing","text":"Node/Interface IPv4 Address IPv6 Address Description rtr 10.0.0.1/32 Loopback Ethernet1 10.1.0.1/30 rtr -> x1 Ethernet2 10.1.0.5/30 rtr -> x2 x1 10.0.0.2/32 Loopback eth1 10.1.0.2/30 x1 -> rtr x2 10.0.0.3/32 Loopback eth1 10.1.0.6/30 x2 -> rtr Trust me for the moment; we\u2019ll discuss them in great detail in subsequent lab exercises. \u21a9 You don\u2019t have to configure the interface circuit-type once you configured the device to be a level-2-only router. A level-2-only router will never send level-1 hellos. \u21a9 The IOSv image on which I had to do that was obviously ancient but still 13 years younger than the RFC 3373 that standardized the three-way handshake. \u21a9 As crazy as it sounds, some devices still use the ancient narrow metrics as the default setting 20 years after the wide metrics were defined in RFC 3784 . \u21a9 The detail option of the show ip route command includes the interface description, and the |begin Priority output filter removes the legend. \u21a9 Code/Length/Value: every bit of information starts with a code (one byte), followed by length (one byte) and the actual value. This encoding approach is more commonly called TLV (Type/Length/Value). \u21a9 There must be some upper limit. \u21a9 In the early days of IS-IS, when people still believed that the OSI protocol stack (with CLNS at layer-3) might win the protocol wars, service providers used official NSAP prefixes allocated by government agencies (see RFC 1237 for details ). CLNS is long gone, and we only need NETs to address IS-IS routers. Area 49.0001 is good enough for that. You can also use Area 51 if you\u2019re so inclined (yes, it works; IS-IS does not care about the contents of the area field). \u21a9","title":"Lab Addressing"},{"location":"basic/2-explore/","text":"Explore IS-IS Data Structures You\u2019ll explore IS-IS adjacencies and the IS-IS LSP database (LSPDB) 1 in this lab. We\u2019ll use the topology from the Configure IS-IS Routing for IPv4 lab exercise: Device Requirements Use any device supported by the netlab IS-IS configuration module . Starting the Lab Assuming you already set up your lab infrastructure : Change directory to basic/2-explore Execute netlab up Log into your device (RTR) with netlab connect rtr You\u2019ll get a lab with IPv4 addresses and IS-IS routing configured on all lab devices. Explore Router Configuration Unless you\u2019re absolutely sure how your router is configured, always start with a high-level overview of IS-IS settings, usually displayed with a command like show isis summary (or maybe it\u2019s called show isis or show isis protocol on your platform). The most significant bits of information include: NET , which can be split into area and system ID . Some devices display NET; others display the IS-IS area and the system ID as independent components. The address families (IPv4, IPv6) Router type: intra-area router (level-1), inter-area router (level-2) or multi-level router 2 (level-1-2, sometimes shown as level-3 because 1+2=3). Try to find the above information in the printout produced by FRRouting and Arista cEOS: Basic IS-IS information displayed by FRRouting $ netlab connect rtr --show isis summary vrf : default Process Id : 32 System Id : 0000.0000.0001 Up time : 00:00:15 ago Number of areas : 1 Area Gandalf: Net: 49.0001.0000.0000.0001.00 TX counters per PDU type: L2 IIH: 2 P2P IIH: 14 L2 LSP: 8 L2 CSNP: 4 L2 PSNP: 4 LSP RXMT: 0 RX counters per PDU type: P2P IIH: 14 L2 LSP: 4 L2 CSNP: 4 L2 PSNP: 4 Drop counters per PDU type: Advertise high metrics: Disabled Level-2: LSP0 regenerated: 2 LSPs purged: 0 SPF: minimum interval : 1 IPv4 route computation: last run elapsed : 00:00:13 ago last run duration : 152 usec run count : 2 Basic IS-IS information displayed by Arista cEOS rtr>show isis summary IS-IS Instance: Gandalf VRF: default Instance ID: 0 System ID: 0000.0000.0001, administratively enabled Router ID: IPv4: 10.0.0.1 Hostname: rtr Multi Topology disabled, not attached IPv4 Preference: Level 1: 115, Level 2: 115 IPv6 Preference: Level 1: 115, Level 2: 115 IS-Type: Level 2, Number active interfaces: 3 Routes IPv4 only LSP size maximum: Level 1: 1492, Level 2: 1492 Interval Type Max Wait Initial Wait Hold Interval ----------------------- -------- ------------ ------------- LSP generation interval 5 s 50 ms 50 ms SPF interval 2000 ms 1000 ms 1000 ms Current SPF hold interval(ms): Level 1: 0, Level 2: 2000 Last Level 2 SPF run 7 seconds ago CSNP generation interval: 10 seconds Dynamic Flooding: Disabled Authentication mode: Level 1: None, Level 2: None Graceful Restart: Disabled, Graceful Restart Helper: Enabled Area addresses: 49.0001 level 2: number DIS interfaces: 0, LSDB size: 3 Area Leader: None Overload Bit is not set. Redistributed Level 1 routes: 0 limit: Not Configured Redistributed Level 2 routes: 0 limit: Not Configured Explore IS-IS Adjacencies IS-IS high-level principles are similar to OSPF ones: A hello protocol is used to discover neighbors. Unlike OSPF, which uses IP as a layer-3 protocol, IS-IS uses its own layer-3 protocol (IS-IS hello packets are encapsulated directly into layer-2 frames; more details ). Once the neighbors are discovered, an adjacency is established with them. Neighbors exchange the contents of their LSP database 3 and, based on the results of that exchange, any missing LSPs. Examining IS-IS neighbors is thus the next logical step after examining the local IS-IS parameters; the command to use is often show isis neighbor (or show isis adjacency ). You should be looking for the following information: The local interface Neighbor name or system ID. Most modern IS-IS implementations display neighbor names 4 . The state of adjacency (it should be Up ) The type of adjacency: intra-area adjacency (level-1), inter-area adjacency (level-2) or multi-level adjacency (level-1-2) 5 . Remote MAC address (SNPA 6 ). The remote MAC address is sometimes displayed as 2020.2020.2020 on point-to-point links. Tip All routers in your lab are configured as level-2 routers and should have only level-2 adjacencies. Another useful command when checking IS-IS adjacencies is show isis interface Try to extract the above information from the printouts generated by FRRouting and Arista cEOS: IS-IS neighbors displayed by FRRouting $ netlab connect rtr --show isis neighbor Area Gandalf: System Id Interface L State Holdtime SNPA x1 eth1 2 Up 29 2020.2020.2020 x2 eth2 2 Up 29 2020.2020.2020 IS-IS neighbors displayed by Arista cEOS rtr>show isis neighbors Instance VRF System Id Type Interface SNPA State Hold time Circuit Id Gandalf default x1 L2 Ethernet1 P2P UP 29 00 Gandalf default x2 L2 Ethernet2 P2P UP 29 00 Sometimes, you have to dig deeper and display neighbor details; a typical command to display those details is show isis neighbor detail . The details include: The address families supported by the neighbor (IPv4, IPv6) Neighbor\u2019s area address and interface IPv4/IPv6 address. Neighbor health statistics, including the number of flaps 7 and the remaining hold timer. Extract the above information from the printouts generated by FRRouting and Arista cEOS. The IS-IS neighbor details displayed by FRRouting $ netlab connect rtr --show isis neighbor detail Area Gandalf: x1 Interface: eth1, Level: 2, State: Up, Expires in 28s Adjacency flaps: 1, Last: 1m22s ago Circuit type: L2, Speaks: IPv4 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.2 x2 Interface: eth2, Level: 2, State: Up, Expires in 27s Adjacency flaps: 1, Last: 1m22s ago Circuit type: L2, Speaks: IPv4 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.6 The IS-IS neighbor details displayed by Arista cEOS rtr>show isis neighbors detail Instance VRF System Id Type Interface SNPA State Hold time Circuit Id Gandalf default x1 L2 Ethernet1 P2P UP 29 00 Area addresses: 49.0001 SNPA: P2P Router ID: 0.0.0.0 Advertised Hold Time: 30 State Changed: 00:02:19 ago at 2024-08-08 10:46:49 IPv4 Interface Address: 10.1.0.2 IPv6 Interface Address: none Interface name: Ethernet1 Graceful Restart: Not Supported Supported Address Families: IPv4 Neighbor Supported Address Families: IPv4 Explore IS-IS LSP Database Like OSPF (with its topology database), IS-IS uses an LSP database 8 (LSPDB). LSPDB is not a true database; it\u2019s a distributed, eventually consistent 9 key-value store shared among all routers in an area or among all inter-area routers. Unlike OSPF, where an ABR could have topology information for multiple areas, IS-IS uses a simpler two-level approach: Routers participating in intra-area routing (level-1 and level-1-2 routers) share a level-1 link-state database containing intra-area topology and prefixes. Level-1-2 and level-2 routers (inter-area routers) share a level-2 link-state database containing inter-area topology and prefixes from all IS-IS areas. Tip All routers in your lab are configured as level-2 routers and thus share only the level-2 LSPDB 10 . OSPF stores various bits of topology information in multiple types of Link State Advertisements (LSA). IS-IS stores all information generated by a single router in a single Link State PDU 11 (LSP) unless it has too much information for a single LSP, in which case it generates multiple LSP fragments ( more details ). Tip IS-IS cannot fragment LSPs in transit; the maximum LSP size must never exceed the lowest MTU of any link in the IS-IS network. IS-IS contains no mechanism to detect the minimum network-wide MTU dynamically; you have to set the maximum LSP size with a router configuration command similar to lsp-mtu . The identifier of an IS-IS LSP (LSP ID) is always in the format systemid.nodeid-fragmentid : The systemid is the 6-octet System ID part of NET . While IS-IS internally uses the 6-octet value, most implementations display hostnames in the show commands. The nodeid is zero for an LSP describing the router\u2019s information and non-zero for LAN pseudonodes 12 . The fragmentid is the sequence number of the LSP fragment . You can inspect the IS-IS topology database with a command similar to show isis database . The short printout usually lists the LSPs (their LSP ID), the LSP length, their sequence number, and their remaining lifetime. Tip A quickly increasing LSP sequence number might indicate routing instabilities. The IS-IS topology database overview displayed by FRRouting $ netlab connect rtr --show isis database Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL rtr.00-00 * 113 0x00000002 0x902e 1626 0/0/0 x1.00-00 92 0x00000002 0x23a0 1659 0/0/0 x2.00-00 92 0x00000002 0xc8f0 1633 0/0/0 3 LSPs The IS-IS topology database overview displayed by Arista cEOS rtr>show isis database Legend: H - hostname conflict U - node unreachable IS-IS Instance: Gandalf VRF: default IS-IS Level 2 Link State Database LSPID Seq Num Cksum Life Length IS Received LSPID Flags rtr.00-00 2 26795 1042 119 L2 0000.0000.0001.00-00 <> x1.00-00 2 9120 1610 92 L2 0000.0000.0002.00-00 <> x2.00-00 2 51440 1610 92 L2 0000.0000.0003.00-00 <> You can inspect the contents of an IS-IS LSP with a command similar to show isis database detail . Each IS-IS LSP contains numerous data items encoded as Type-Length-Value (TLV) triplets. The TLV values are usually displayed in a human-friendly format; you\u2019d have to use a packet capture tool like tcpdump or wireshark to see the dirty details. The recognized IS-IS data types are collected in the IANA IS-IS TLV Codepoints registry; you\u2019d usually see the following TLVs in a modern IPv4 network: TLV Description 1 Area address 137 Hostname 242 Router capabilities 129 Supported protocols (IPv4/IPv6) 22 Extended IS Reachability 13 The information about an adjacent router and the cost to reach it 132 IPv4 Interface Address 135 IPv4 Extended Reachability The cost of a connected prefix This is how FRRouting and Arista cEOS display the LSP information: LSP content displayed by FRRouting $ netlab connect rtr --show isis database detail rtr.00-00 Connecting to container clab-explore-rtr, executing vtysh -c \"show isis database detail rtr.00-00\" Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL rtr.00-00 * 113 0x00000002 0x902e 1589 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: rtr TE Router ID: 10.0.0.1 Router Capability: 10.0.0.1 , D:0, S:0 Extended Reachability: 0000.0000.0002.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 10) IPv4 Interface Address: 10.0.0.1 Extended IP Reachability: 10.0.0.1/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10) LSP content displayed by Arista EOS rtr>show isis database rtr.00-00 detail Legend: H - hostname conflict U - node unreachable IS-IS Instance: Gandalf VRF: default IS-IS Level 2 Link State Database LSPID Seq Num Cksum Life Length IS Received LSPID Flags rtr.00-00 2 26795 1001 119 L2 0000.0000.0001.00-00 <> LSP generation remaining wait time: 0 ms Time remaining until refresh: 701 s NLPID: 0xCC(IPv4) Hostname: rtr Area addresses: 49.0001 Interface address: 10.1.0.5 Interface address: 10.1.0.1 Interface address: 10.0.0.1 IS Neighbor : x1.00 Metric: 10 IS Neighbor : x2.00 Metric: 10 Reachability : 10.1.0.4/30 Metric: 10 Type: 1 Up Reachability : 10.1.0.0/30 Metric: 10 Type: 1 Up Reachability : 10.0.0.1/32 Metric: 10 Type: 1 Up Router Capabilities: Router Id: 10.0.0.1 Flags: [] Area leader priority: 250 algorithm: 0 The Shortest Path First (SPF) algorithm uses the information from the LSPDB to build a shortest-path (lowest-cost) tree spanning the network topology: The LSPs are nodes in the topology graph The \u200cExtended IS Reachability TLVs describe the unidirectional connectivity between nodes. The SPF algorithm has to do a two-way connectivity check (TWCC) 14 to verify two nodes can communicate. Links that don\u2019t pass the TWCC are not considered when building the shortest-path tree. After the SPF algorithm generates the spanning tree, it uses the minimum cost toward each node together with the Extended IP Reachability TLVs advertised by those nodes to find the minimum cost (and the optimum node/path/next hop) toward every prefix advertised by other routers. LSP Fragments You rarely see LSP fragments in small networks, but it\u2019s pretty easy to generate them by lowering the maximum LSP size. For example, if we reduce the LSP size on rtr to 256, we\u2019ll get two fragments: rtr# show isis database Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL rtr.00-00 * 67 0x00000024 0xe3a6 1648 0/0/0 rtr.00-01 * 75 0x00000006 0xa54b 1648 0/0/0 x1.00-00 92 0x00000017 0xf8b5 1288 0/0/0 x2.00-00 92 0x00000018 0x9c07 1043 0/0/0 The LSP fragments contain the same information as the original LSP, only split across multiple smaller database objects: rtr# show isis database detail rtr.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL rtr.00-00 * 67 0x00000024 0xe3a6 1590 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: rtr TE Router ID: 10.0.0.1 Router Capability: 10.0.0.1 , D:0, S:0 Extended Reachability: 0000.0000.0002.00 (Metric: 10) rtr# show isis database detail rtr.00-01 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL rtr.00-01 * 75 0x00000006 0xa54b 1589 0/0/0 Extended Reachability: 0000.0000.0003.00 (Metric: 10) IPv4 Interface Address: 10.0.0.1 Extended IP Reachability: 10.0.0.1/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10) Next: IS-IS on Point-to-Point Links Reference Information Lab Wiring Origin Device Origin Port Destination Device Destination Port rtr Ethernet1 x1 eth1 rtr Ethernet2 x2 eth1 Note: The interface names depend on the devices you use in the lab. The printout was generated with Arista EOS running on RTR and FRRouting running on X1 and X2. Lab Addressing Node/Interface IPv4 Address IPv6 Address Description rtr 10.0.0.1/32 Loopback Ethernet1 10.1.0.1/30 rtr -> x1 Ethernet2 10.1.0.5/30 rtr -> x2 x1 10.0.0.2/32 Loopback eth1 10.1.0.2/30 x1 -> rtr x2 10.0.0.3/32 Loopback eth1 10.1.0.6/30 x2 -> rtr IS-IS equivalent of OSPF link-state database \u21a9 Similar, but not exactly equivalent to OSPF ABR \u21a9 Using the Complete Sequence Number Packets (CSNP) \u2013 a list of LSP descriptors (objects containing LSP-ID, LSP sequence number, remaining lifetime, and checksum). \u21a9 Router names are advertised using the Dynamic Hostname TLV defined in RFC 5301 . \u21a9 We\u2019re using level-2-only routers in the initial lab exercises. We\u2019ll explore multi-level routing in one of the more advanced exercises. \u21a9 Subnetwork point of attachment \u2013 a fancy OSI name for a MAC address. \u21a9 Not available on all platforms \u21a9 LSP (Link-State Protocol Data Unit) is the object a router uses to report information about the adjacent routers and known prefixes. \u21a9 The changes a router makes to an LSP are flooded across the network and are not visible to all other routers at the same time. All routers will eventually receive the changes though. \u21a9 We\u2019ll cover multi-level IS-IS routing in another lab exercise. \u21a9 Protocol Data Unit, a fancy name for a packet. \u21a9 LAN pseudonodes are equivalent to OSPF type-2 LSA2. They are used on multi-access subnets; you should never encounter them if you\u2019re using IS-IS point-to-point links. \u21a9 Also known as Wide Metrics (covered in another lab exercise). \u21a9 Node A must have an extended IS reachability TLV for node B, while at the same time, node B has an extended IS reachability TLV for node A. That\u2019s the best IS-IS can do, but even that is not enough if there are multiple point-to-point links between A and B. The proof is left as an exercise for the reader; you might find hints in RFC 5303 . \u21a9","title":"Explore IS-IS Data Structures"},{"location":"basic/2-explore/#explore-is-is-data-structures","text":"You\u2019ll explore IS-IS adjacencies and the IS-IS LSP database (LSPDB) 1 in this lab. We\u2019ll use the topology from the Configure IS-IS Routing for IPv4 lab exercise:","title":"Explore IS-IS Data Structures"},{"location":"basic/2-explore/#device-requirements","text":"Use any device supported by the netlab IS-IS configuration module .","title":"Device Requirements"},{"location":"basic/2-explore/#starting-the-lab","text":"Assuming you already set up your lab infrastructure : Change directory to basic/2-explore Execute netlab up Log into your device (RTR) with netlab connect rtr You\u2019ll get a lab with IPv4 addresses and IS-IS routing configured on all lab devices.","title":"Starting the Lab"},{"location":"basic/2-explore/#explore-router-configuration","text":"Unless you\u2019re absolutely sure how your router is configured, always start with a high-level overview of IS-IS settings, usually displayed with a command like show isis summary (or maybe it\u2019s called show isis or show isis protocol on your platform). The most significant bits of information include: NET , which can be split into area and system ID . Some devices display NET; others display the IS-IS area and the system ID as independent components. The address families (IPv4, IPv6) Router type: intra-area router (level-1), inter-area router (level-2) or multi-level router 2 (level-1-2, sometimes shown as level-3 because 1+2=3). Try to find the above information in the printout produced by FRRouting and Arista cEOS: Basic IS-IS information displayed by FRRouting $ netlab connect rtr --show isis summary vrf : default Process Id : 32 System Id : 0000.0000.0001 Up time : 00:00:15 ago Number of areas : 1 Area Gandalf: Net: 49.0001.0000.0000.0001.00 TX counters per PDU type: L2 IIH: 2 P2P IIH: 14 L2 LSP: 8 L2 CSNP: 4 L2 PSNP: 4 LSP RXMT: 0 RX counters per PDU type: P2P IIH: 14 L2 LSP: 4 L2 CSNP: 4 L2 PSNP: 4 Drop counters per PDU type: Advertise high metrics: Disabled Level-2: LSP0 regenerated: 2 LSPs purged: 0 SPF: minimum interval : 1 IPv4 route computation: last run elapsed : 00:00:13 ago last run duration : 152 usec run count : 2 Basic IS-IS information displayed by Arista cEOS rtr>show isis summary IS-IS Instance: Gandalf VRF: default Instance ID: 0 System ID: 0000.0000.0001, administratively enabled Router ID: IPv4: 10.0.0.1 Hostname: rtr Multi Topology disabled, not attached IPv4 Preference: Level 1: 115, Level 2: 115 IPv6 Preference: Level 1: 115, Level 2: 115 IS-Type: Level 2, Number active interfaces: 3 Routes IPv4 only LSP size maximum: Level 1: 1492, Level 2: 1492 Interval Type Max Wait Initial Wait Hold Interval ----------------------- -------- ------------ ------------- LSP generation interval 5 s 50 ms 50 ms SPF interval 2000 ms 1000 ms 1000 ms Current SPF hold interval(ms): Level 1: 0, Level 2: 2000 Last Level 2 SPF run 7 seconds ago CSNP generation interval: 10 seconds Dynamic Flooding: Disabled Authentication mode: Level 1: None, Level 2: None Graceful Restart: Disabled, Graceful Restart Helper: Enabled Area addresses: 49.0001 level 2: number DIS interfaces: 0, LSDB size: 3 Area Leader: None Overload Bit is not set. Redistributed Level 1 routes: 0 limit: Not Configured Redistributed Level 2 routes: 0 limit: Not Configured","title":"Explore Router Configuration"},{"location":"basic/2-explore/#explore-is-is-adjacencies","text":"IS-IS high-level principles are similar to OSPF ones: A hello protocol is used to discover neighbors. Unlike OSPF, which uses IP as a layer-3 protocol, IS-IS uses its own layer-3 protocol (IS-IS hello packets are encapsulated directly into layer-2 frames; more details ). Once the neighbors are discovered, an adjacency is established with them. Neighbors exchange the contents of their LSP database 3 and, based on the results of that exchange, any missing LSPs. Examining IS-IS neighbors is thus the next logical step after examining the local IS-IS parameters; the command to use is often show isis neighbor (or show isis adjacency ). You should be looking for the following information: The local interface Neighbor name or system ID. Most modern IS-IS implementations display neighbor names 4 . The state of adjacency (it should be Up ) The type of adjacency: intra-area adjacency (level-1), inter-area adjacency (level-2) or multi-level adjacency (level-1-2) 5 . Remote MAC address (SNPA 6 ). The remote MAC address is sometimes displayed as 2020.2020.2020 on point-to-point links. Tip All routers in your lab are configured as level-2 routers and should have only level-2 adjacencies. Another useful command when checking IS-IS adjacencies is show isis interface Try to extract the above information from the printouts generated by FRRouting and Arista cEOS: IS-IS neighbors displayed by FRRouting $ netlab connect rtr --show isis neighbor Area Gandalf: System Id Interface L State Holdtime SNPA x1 eth1 2 Up 29 2020.2020.2020 x2 eth2 2 Up 29 2020.2020.2020 IS-IS neighbors displayed by Arista cEOS rtr>show isis neighbors Instance VRF System Id Type Interface SNPA State Hold time Circuit Id Gandalf default x1 L2 Ethernet1 P2P UP 29 00 Gandalf default x2 L2 Ethernet2 P2P UP 29 00 Sometimes, you have to dig deeper and display neighbor details; a typical command to display those details is show isis neighbor detail . The details include: The address families supported by the neighbor (IPv4, IPv6) Neighbor\u2019s area address and interface IPv4/IPv6 address. Neighbor health statistics, including the number of flaps 7 and the remaining hold timer. Extract the above information from the printouts generated by FRRouting and Arista cEOS. The IS-IS neighbor details displayed by FRRouting $ netlab connect rtr --show isis neighbor detail Area Gandalf: x1 Interface: eth1, Level: 2, State: Up, Expires in 28s Adjacency flaps: 1, Last: 1m22s ago Circuit type: L2, Speaks: IPv4 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.2 x2 Interface: eth2, Level: 2, State: Up, Expires in 27s Adjacency flaps: 1, Last: 1m22s ago Circuit type: L2, Speaks: IPv4 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.6 The IS-IS neighbor details displayed by Arista cEOS rtr>show isis neighbors detail Instance VRF System Id Type Interface SNPA State Hold time Circuit Id Gandalf default x1 L2 Ethernet1 P2P UP 29 00 Area addresses: 49.0001 SNPA: P2P Router ID: 0.0.0.0 Advertised Hold Time: 30 State Changed: 00:02:19 ago at 2024-08-08 10:46:49 IPv4 Interface Address: 10.1.0.2 IPv6 Interface Address: none Interface name: Ethernet1 Graceful Restart: Not Supported Supported Address Families: IPv4 Neighbor Supported Address Families: IPv4","title":"Explore IS-IS Adjacencies"},{"location":"basic/2-explore/#lspdb","text":"Like OSPF (with its topology database), IS-IS uses an LSP database 8 (LSPDB). LSPDB is not a true database; it\u2019s a distributed, eventually consistent 9 key-value store shared among all routers in an area or among all inter-area routers. Unlike OSPF, where an ABR could have topology information for multiple areas, IS-IS uses a simpler two-level approach: Routers participating in intra-area routing (level-1 and level-1-2 routers) share a level-1 link-state database containing intra-area topology and prefixes. Level-1-2 and level-2 routers (inter-area routers) share a level-2 link-state database containing inter-area topology and prefixes from all IS-IS areas. Tip All routers in your lab are configured as level-2 routers and thus share only the level-2 LSPDB 10 . OSPF stores various bits of topology information in multiple types of Link State Advertisements (LSA). IS-IS stores all information generated by a single router in a single Link State PDU 11 (LSP) unless it has too much information for a single LSP, in which case it generates multiple LSP fragments ( more details ). Tip IS-IS cannot fragment LSPs in transit; the maximum LSP size must never exceed the lowest MTU of any link in the IS-IS network. IS-IS contains no mechanism to detect the minimum network-wide MTU dynamically; you have to set the maximum LSP size with a router configuration command similar to lsp-mtu . The identifier of an IS-IS LSP (LSP ID) is always in the format systemid.nodeid-fragmentid : The systemid is the 6-octet System ID part of NET . While IS-IS internally uses the 6-octet value, most implementations display hostnames in the show commands. The nodeid is zero for an LSP describing the router\u2019s information and non-zero for LAN pseudonodes 12 . The fragmentid is the sequence number of the LSP fragment . You can inspect the IS-IS topology database with a command similar to show isis database . The short printout usually lists the LSPs (their LSP ID), the LSP length, their sequence number, and their remaining lifetime. Tip A quickly increasing LSP sequence number might indicate routing instabilities. The IS-IS topology database overview displayed by FRRouting $ netlab connect rtr --show isis database Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL rtr.00-00 * 113 0x00000002 0x902e 1626 0/0/0 x1.00-00 92 0x00000002 0x23a0 1659 0/0/0 x2.00-00 92 0x00000002 0xc8f0 1633 0/0/0 3 LSPs The IS-IS topology database overview displayed by Arista cEOS rtr>show isis database Legend: H - hostname conflict U - node unreachable IS-IS Instance: Gandalf VRF: default IS-IS Level 2 Link State Database LSPID Seq Num Cksum Life Length IS Received LSPID Flags rtr.00-00 2 26795 1042 119 L2 0000.0000.0001.00-00 <> x1.00-00 2 9120 1610 92 L2 0000.0000.0002.00-00 <> x2.00-00 2 51440 1610 92 L2 0000.0000.0003.00-00 <> You can inspect the contents of an IS-IS LSP with a command similar to show isis database detail . Each IS-IS LSP contains numerous data items encoded as Type-Length-Value (TLV) triplets. The TLV values are usually displayed in a human-friendly format; you\u2019d have to use a packet capture tool like tcpdump or wireshark to see the dirty details. The recognized IS-IS data types are collected in the IANA IS-IS TLV Codepoints registry; you\u2019d usually see the following TLVs in a modern IPv4 network: TLV Description 1 Area address 137 Hostname 242 Router capabilities 129 Supported protocols (IPv4/IPv6) 22 Extended IS Reachability 13 The information about an adjacent router and the cost to reach it 132 IPv4 Interface Address 135 IPv4 Extended Reachability The cost of a connected prefix This is how FRRouting and Arista cEOS display the LSP information: LSP content displayed by FRRouting $ netlab connect rtr --show isis database detail rtr.00-00 Connecting to container clab-explore-rtr, executing vtysh -c \"show isis database detail rtr.00-00\" Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL rtr.00-00 * 113 0x00000002 0x902e 1589 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: rtr TE Router ID: 10.0.0.1 Router Capability: 10.0.0.1 , D:0, S:0 Extended Reachability: 0000.0000.0002.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 10) IPv4 Interface Address: 10.0.0.1 Extended IP Reachability: 10.0.0.1/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10) LSP content displayed by Arista EOS rtr>show isis database rtr.00-00 detail Legend: H - hostname conflict U - node unreachable IS-IS Instance: Gandalf VRF: default IS-IS Level 2 Link State Database LSPID Seq Num Cksum Life Length IS Received LSPID Flags rtr.00-00 2 26795 1001 119 L2 0000.0000.0001.00-00 <> LSP generation remaining wait time: 0 ms Time remaining until refresh: 701 s NLPID: 0xCC(IPv4) Hostname: rtr Area addresses: 49.0001 Interface address: 10.1.0.5 Interface address: 10.1.0.1 Interface address: 10.0.0.1 IS Neighbor : x1.00 Metric: 10 IS Neighbor : x2.00 Metric: 10 Reachability : 10.1.0.4/30 Metric: 10 Type: 1 Up Reachability : 10.1.0.0/30 Metric: 10 Type: 1 Up Reachability : 10.0.0.1/32 Metric: 10 Type: 1 Up Router Capabilities: Router Id: 10.0.0.1 Flags: [] Area leader priority: 250 algorithm: 0 The Shortest Path First (SPF) algorithm uses the information from the LSPDB to build a shortest-path (lowest-cost) tree spanning the network topology: The LSPs are nodes in the topology graph The \u200cExtended IS Reachability TLVs describe the unidirectional connectivity between nodes. The SPF algorithm has to do a two-way connectivity check (TWCC) 14 to verify two nodes can communicate. Links that don\u2019t pass the TWCC are not considered when building the shortest-path tree. After the SPF algorithm generates the spanning tree, it uses the minimum cost toward each node together with the Extended IP Reachability TLVs advertised by those nodes to find the minimum cost (and the optimum node/path/next hop) toward every prefix advertised by other routers.","title":"Explore IS-IS LSP Database"},{"location":"basic/2-explore/#frag","text":"You rarely see LSP fragments in small networks, but it\u2019s pretty easy to generate them by lowering the maximum LSP size. For example, if we reduce the LSP size on rtr to 256, we\u2019ll get two fragments: rtr# show isis database Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL rtr.00-00 * 67 0x00000024 0xe3a6 1648 0/0/0 rtr.00-01 * 75 0x00000006 0xa54b 1648 0/0/0 x1.00-00 92 0x00000017 0xf8b5 1288 0/0/0 x2.00-00 92 0x00000018 0x9c07 1043 0/0/0 The LSP fragments contain the same information as the original LSP, only split across multiple smaller database objects: rtr# show isis database detail rtr.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL rtr.00-00 * 67 0x00000024 0xe3a6 1590 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: rtr TE Router ID: 10.0.0.1 Router Capability: 10.0.0.1 , D:0, S:0 Extended Reachability: 0000.0000.0002.00 (Metric: 10) rtr# show isis database detail rtr.00-01 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL rtr.00-01 * 75 0x00000006 0xa54b 1589 0/0/0 Extended Reachability: 0000.0000.0003.00 (Metric: 10) IPv4 Interface Address: 10.0.0.1 Extended IP Reachability: 10.0.0.1/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10) Next: IS-IS on Point-to-Point Links","title":"LSP Fragments"},{"location":"basic/2-explore/#reference-information","text":"","title":"Reference Information"},{"location":"basic/2-explore/#lab-wiring","text":"Origin Device Origin Port Destination Device Destination Port rtr Ethernet1 x1 eth1 rtr Ethernet2 x2 eth1 Note: The interface names depend on the devices you use in the lab. The printout was generated with Arista EOS running on RTR and FRRouting running on X1 and X2.","title":"Lab Wiring"},{"location":"basic/2-explore/#lab-addressing","text":"Node/Interface IPv4 Address IPv6 Address Description rtr 10.0.0.1/32 Loopback Ethernet1 10.1.0.1/30 rtr -> x1 Ethernet2 10.1.0.5/30 rtr -> x2 x1 10.0.0.2/32 Loopback eth1 10.1.0.2/30 x1 -> rtr x2 10.0.0.3/32 Loopback eth1 10.1.0.6/30 x2 -> rtr IS-IS equivalent of OSPF link-state database \u21a9 Similar, but not exactly equivalent to OSPF ABR \u21a9 Using the Complete Sequence Number Packets (CSNP) \u2013 a list of LSP descriptors (objects containing LSP-ID, LSP sequence number, remaining lifetime, and checksum). \u21a9 Router names are advertised using the Dynamic Hostname TLV defined in RFC 5301 . \u21a9 We\u2019re using level-2-only routers in the initial lab exercises. We\u2019ll explore multi-level routing in one of the more advanced exercises. \u21a9 Subnetwork point of attachment \u2013 a fancy OSI name for a MAC address. \u21a9 Not available on all platforms \u21a9 LSP (Link-State Protocol Data Unit) is the object a router uses to report information about the adjacent routers and known prefixes. \u21a9 The changes a router makes to an LSP are flooded across the network and are not visible to all other routers at the same time. All routers will eventually receive the changes though. \u21a9 We\u2019ll cover multi-level IS-IS routing in another lab exercise. \u21a9 Protocol Data Unit, a fancy name for a packet. \u21a9 LAN pseudonodes are equivalent to OSPF type-2 LSA2. They are used on multi-access subnets; you should never encounter them if you\u2019re using IS-IS point-to-point links. \u21a9 Also known as Wide Metrics (covered in another lab exercise). \u21a9 Node A must have an extended IS reachability TLV for node B, while at the same time, node B has an extended IS reachability TLV for node A. That\u2019s the best IS-IS can do, but even that is not enough if there are multiple point-to-point links between A and B. The proof is left as an exercise for the reader; you might find hints in RFC 5303 . \u21a9","title":"Lab Addressing"},{"location":"basic/3-p2p/","text":"IS-IS on Point-to-Point Links In the Configure IS-IS Routing for IPv4 lab exercise, I told you to configure the links as point-to-point links and promised a detailed explanation in a follow-up lab exercise. We got that far; let\u2019s see why using point-to-point links on Ethernet interfaces is strongly preferred. To keep things simple, we\u2019ll use the simplest possible lab topology: two routers connected with a single link. Device Requirements Use any device supported by the netlab IS-IS configuration module . Starting the Lab Assuming you already set up your lab infrastructure : Change directory to basic/3-p2p Execute netlab up Log into lab devices with netlab connect You\u2019ll get a lab with IPv4 addresses and minimal IS-IS configurations on all devices. Point-to-Point and Multi-Access Links Like OSPF, IS-IS supports point-to-point (P2P) and multi-access links. Point-to-point links were traditionally used on P2P WAN links; all other media types (LAN, but also multi-access WAN like Frame Relay) used multi-access links. That\u2019s still the default behavior you get on most platforms. Multi-access links have several drawbacks when compared to point-to-point links: The routers on a multi-access link must elect 1 a Designated Intermediate System 2 , prolonging the adjacency establishment process 3 . Unlike OSPF, there is no Backup DIS in IS-IS; routers connected to a multi-access link elect a new DIS when the current one is gone 4 . The IS-IS LSP database contains extra objects. Instead of point-to-point links between the routers, the LSPDB contains pseudonode LSPs (originated by DIS 5 ) describing LAN links 6 . For example, our simple topology would result in the following LSPDB objects 7 : \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502r1.00-00\u251c\u2500\u2500\u2500\u2524r2.8e-00\u251c\u2500\u2500\u2500\u2524r2.00-00\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Recovery from transmission errors takes longer on LAN links. There are no retransmissions in IS-IS; routers realize there\u2019s a problem when the DIS sends a list of its LSPDB contents (CSNP packets), usually every 10 seconds. On the other hand, using pseudonode LSPs on true multi-access links makes perfect sense. They reduce the number of links in the topology graph 8 , resulting in faster SPF runs. Exploring Multi-Access Database Structures It\u2019s time to get our hands dirty. Log into one of the lab devices and examine its IS-IS database. You should get a printout similar to this one. Please note an extra LSP (the description of the LAN subnet generated by R2): r1# show isis database Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 92 0x00000005 0xc392 1164 0/0/0 r2.00-00 92 0x00000005 0x60ef 1167 0/0/0 r2.74-00 51 0x00000003 0x5202 1239 0/0/0 Let\u2019s inspect the extra LSP. It looks very similar to an OSPF type-2 LSA: It describes links from the LAN segment to individual routers. Unlike OSPF type-2 LSA, it does not contain the LAN prefix. r1# show isis database detail r2.74-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r2.74-00 51 0x00000003 0x5202 1130 0/0/0 Extended Reachability: 0000.0000.0002.00 (Metric: 0) Extended Reachability: 0000.0000.0001.00 (Metric: 0) Tip The core IS-IS data structures are protocol-agnostic. Protocol-specific prefixes are advertised as part of the router LSP. Not surprisingly, the routers connected to the LAN segment advertise their links to the LAN segment and the LAN IPv4 prefix. This is what R1 has to say: r1# show isis database detail r1.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 92 0x00000006 0xc193 1780 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: r1 TE Router ID: 10.0.0.1 Router Capability: 10.0.0.1 , D:0, S:0 Extended Reachability: 0000.0000.0002.74 (Metric: 10) IPv4 Interface Address: 10.0.0.1 Extended IP Reachability: 10.0.0.1/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Tip It\u2019s worth noting that the router LSP does not specify the interface on which a particular IP prefix is; it just claims that the router knows how to reach the prefix with the specified cost. That\u2019s enough to find the optimum paths to all prefixes in the network 9 Using Point-to-Point Links Core Ethernet links in modern networks are usually point-to-point links 10 between routers 11 . Modeling those links as multi-access networks makes no sense, yet most IS-IS implementations use that approach on all LAN interfaces. Use an interface configuration command similar to isis network point-to-point to tell IS-IS to treat an interface like a point-to-point link. Do that on both routers in your network. Tip While changing the interface type, you might observe logging/error messages similar to p2p hello on non p2p circuit or lan hello on non broadcast circuit 12 . Warning If you use Cisco IOSv on one of the routers and some other network operating system on the other router, you have to configure \u200cisis three-way-handshake ietf on Cisco IOSv interfaces ( more details ) because someone thought it prudent to keep the pre-standard protocol as the default setting for at least a decade after the RFC was published. Cisco IOS XE uses the IETF 3-way handshake as the default protocol. Let\u2019s inspect the IS-IS topology database after the change. As expected, it contains two LSPs (one per router). r1# show isis database Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 92 0x00000008 0x5d6a 1598 0/0/0 r2.00-00 92 0x00000009 0xd4ec 1558 0/0/0 The LSPs describe the direct connection between the routers. For example, R1 claims it\u2019s directly connected to R2 13 : r1# show isis database detail r1.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 92 0x00000008 0x5d6a 1533 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: r1 TE Router ID: 10.0.0.1 Router Capability: 10.0.0.1 , D:0, S:0 Extended Reachability: 0000.0000.0002.00 (Metric: 10) IPv4 Interface Address: 10.0.0.1 Extended IP Reachability: 10.0.0.1/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Next: Using IS-IS Metrics Optimize Simple IS-IS Deployments Three-Way Handshake The original IS-IS specifications used a simple HELLO protocol on point-to-point links 14 : whenever a router received an IS-IS Hello (IIH) from an adjacent router, it assumed the adjacent router could be reached, resulting in miserable failures on unidirectional links 15 . That hurdle was removed with the three-way handshake defined in RFC 5303 . That RFC specifies a new IS-IS option (Point-to-Point Three-Way Adjacency) that contains the System ID of the adjacent device, allowing IS-IS routers to verify they have a two-way communication. Modern IS-IS implementations use the three-way handshake by default. Still, you might have to turn it off to interoperate with an older device (or a device with ancient defaults) with an interface command similar to no isis three-way-handshake 16 . Warning A mismatch in the three-way handshake setting could have bizarre results. For example, turning it off on a FRRouting device results in one of the neighbors having a fully operational IS-IS adjacency while, at the same time, the other neighbor claims it can see no neighbors. To make matters worse, that often happens only after the IS-IS adjacency has been lost and would have to be re-established. As the last task in this lab, try out how your devices react to a three-way-handshake mismatch (assuming you can configure it): Turn it off on one of the routers. Clear the IS-IS adjacency with a command similar to clear isis neighbor Enjoy the confusing logging messages. Next: Using IS-IS Metrics Optimize Simple IS-IS Deployments Reference Information Lab Wiring Origin Device Origin Port Destination Device Destination Port r1 eth1 r2 eth1 Lab Addressing Node/Interface IPv4 Address IPv6 Address Description r1 10.0.0.1/32 Loopback eth1 10.1.0.1/30 r1 -> r2 r2 10.0.0.2/32 Loopback eth1 10.1.0.2/30 r2 -> r1 Like OSPF, the election process considers router priority and its System ID. \u21a9 Intermediate System is an OSI-compliant word for a router. OSPF would call DIS a DR. \u21a9 And consequently, the overall convergence time after a link recovery. \u21a9 DIS does not have the critical role that OSPF DR has. DIS is not responsible for the flooding of LSP changes; its only role is to help detect transmission errors by periodically sending table-of-contents (CSNP) of its LSPDB. \u21a9 Remember the nodeid octet in the LSP ID? That octet uniquely identifies a pseudonode originated by a DIS. The systemid in a pseudonode LSP is identical to the DIS systemid , making it very simple to identify the DIS. \u21a9 The pseudonode LSP is very similar to OSPF type-2 LSA. \u21a9 The LSP ID of the LAN pseudonode depends on the implementation \u21a9 A star topology with the pseudonode LSP in the middle as opposed to a full mesh topology \u21a9 The proof is left as an exercise for the reader. \u21a9 A major exception: routers connected to a Carrier Ethernet E-LAN service. \u21a9 The devices also known as layer-3 switches in marketing collaterals. \u21a9 On many network devices, you must enable message logging on terminal sessions with a command similar to terminal monitor . \u21a9 FRR printouts are a bit inconsistent. Router names are displayed in high-level printouts, while the detailed printouts contain system IDs. Use the show isis hostname command to display the mapping between system IDs and hostnames. \u21a9 IS-IS hello packets on multi-access media (as well as OSPF) always had a field specifying IS-IS neighbors a router can see. For whatever reason, that field was not present in the original specification of IS-IS hello packets used on point-to-point links. \u21a9 See the introduction section of RFC 5303 for more details. \u21a9 RFC 5303 was published in 2008, and recent IS-IS implementations, for example, Arista EOS, no longer have that nerd knob. \u21a9","title":"IS-IS on Point-to-Point Links"},{"location":"basic/3-p2p/#is-is-on-point-to-point-links","text":"In the Configure IS-IS Routing for IPv4 lab exercise, I told you to configure the links as point-to-point links and promised a detailed explanation in a follow-up lab exercise. We got that far; let\u2019s see why using point-to-point links on Ethernet interfaces is strongly preferred. To keep things simple, we\u2019ll use the simplest possible lab topology: two routers connected with a single link.","title":"IS-IS on Point-to-Point Links"},{"location":"basic/3-p2p/#device-requirements","text":"Use any device supported by the netlab IS-IS configuration module .","title":"Device Requirements"},{"location":"basic/3-p2p/#starting-the-lab","text":"Assuming you already set up your lab infrastructure : Change directory to basic/3-p2p Execute netlab up Log into lab devices with netlab connect You\u2019ll get a lab with IPv4 addresses and minimal IS-IS configurations on all devices.","title":"Starting the Lab"},{"location":"basic/3-p2p/#point-to-point-and-multi-access-links","text":"Like OSPF, IS-IS supports point-to-point (P2P) and multi-access links. Point-to-point links were traditionally used on P2P WAN links; all other media types (LAN, but also multi-access WAN like Frame Relay) used multi-access links. That\u2019s still the default behavior you get on most platforms. Multi-access links have several drawbacks when compared to point-to-point links: The routers on a multi-access link must elect 1 a Designated Intermediate System 2 , prolonging the adjacency establishment process 3 . Unlike OSPF, there is no Backup DIS in IS-IS; routers connected to a multi-access link elect a new DIS when the current one is gone 4 . The IS-IS LSP database contains extra objects. Instead of point-to-point links between the routers, the LSPDB contains pseudonode LSPs (originated by DIS 5 ) describing LAN links 6 . For example, our simple topology would result in the following LSPDB objects 7 : \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502r1.00-00\u251c\u2500\u2500\u2500\u2524r2.8e-00\u251c\u2500\u2500\u2500\u2524r2.00-00\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 Recovery from transmission errors takes longer on LAN links. There are no retransmissions in IS-IS; routers realize there\u2019s a problem when the DIS sends a list of its LSPDB contents (CSNP packets), usually every 10 seconds. On the other hand, using pseudonode LSPs on true multi-access links makes perfect sense. They reduce the number of links in the topology graph 8 , resulting in faster SPF runs.","title":"Point-to-Point and Multi-Access Links"},{"location":"basic/3-p2p/#exploring-multi-access-database-structures","text":"It\u2019s time to get our hands dirty. Log into one of the lab devices and examine its IS-IS database. You should get a printout similar to this one. Please note an extra LSP (the description of the LAN subnet generated by R2): r1# show isis database Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 92 0x00000005 0xc392 1164 0/0/0 r2.00-00 92 0x00000005 0x60ef 1167 0/0/0 r2.74-00 51 0x00000003 0x5202 1239 0/0/0 Let\u2019s inspect the extra LSP. It looks very similar to an OSPF type-2 LSA: It describes links from the LAN segment to individual routers. Unlike OSPF type-2 LSA, it does not contain the LAN prefix. r1# show isis database detail r2.74-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r2.74-00 51 0x00000003 0x5202 1130 0/0/0 Extended Reachability: 0000.0000.0002.00 (Metric: 0) Extended Reachability: 0000.0000.0001.00 (Metric: 0) Tip The core IS-IS data structures are protocol-agnostic. Protocol-specific prefixes are advertised as part of the router LSP. Not surprisingly, the routers connected to the LAN segment advertise their links to the LAN segment and the LAN IPv4 prefix. This is what R1 has to say: r1# show isis database detail r1.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 92 0x00000006 0xc193 1780 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: r1 TE Router ID: 10.0.0.1 Router Capability: 10.0.0.1 , D:0, S:0 Extended Reachability: 0000.0000.0002.74 (Metric: 10) IPv4 Interface Address: 10.0.0.1 Extended IP Reachability: 10.0.0.1/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Tip It\u2019s worth noting that the router LSP does not specify the interface on which a particular IP prefix is; it just claims that the router knows how to reach the prefix with the specified cost. That\u2019s enough to find the optimum paths to all prefixes in the network 9","title":"Exploring Multi-Access Database Structures"},{"location":"basic/3-p2p/#using-point-to-point-links","text":"Core Ethernet links in modern networks are usually point-to-point links 10 between routers 11 . Modeling those links as multi-access networks makes no sense, yet most IS-IS implementations use that approach on all LAN interfaces. Use an interface configuration command similar to isis network point-to-point to tell IS-IS to treat an interface like a point-to-point link. Do that on both routers in your network. Tip While changing the interface type, you might observe logging/error messages similar to p2p hello on non p2p circuit or lan hello on non broadcast circuit 12 . Warning If you use Cisco IOSv on one of the routers and some other network operating system on the other router, you have to configure \u200cisis three-way-handshake ietf on Cisco IOSv interfaces ( more details ) because someone thought it prudent to keep the pre-standard protocol as the default setting for at least a decade after the RFC was published. Cisco IOS XE uses the IETF 3-way handshake as the default protocol. Let\u2019s inspect the IS-IS topology database after the change. As expected, it contains two LSPs (one per router). r1# show isis database Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 92 0x00000008 0x5d6a 1598 0/0/0 r2.00-00 92 0x00000009 0xd4ec 1558 0/0/0 The LSPs describe the direct connection between the routers. For example, R1 claims it\u2019s directly connected to R2 13 : r1# show isis database detail r1.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 92 0x00000008 0x5d6a 1533 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: r1 TE Router ID: 10.0.0.1 Router Capability: 10.0.0.1 , D:0, S:0 Extended Reachability: 0000.0000.0002.00 (Metric: 10) IPv4 Interface Address: 10.0.0.1 Extended IP Reachability: 10.0.0.1/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Next: Using IS-IS Metrics Optimize Simple IS-IS Deployments","title":"Using Point-to-Point Links"},{"location":"basic/3-p2p/#3whs","text":"The original IS-IS specifications used a simple HELLO protocol on point-to-point links 14 : whenever a router received an IS-IS Hello (IIH) from an adjacent router, it assumed the adjacent router could be reached, resulting in miserable failures on unidirectional links 15 . That hurdle was removed with the three-way handshake defined in RFC 5303 . That RFC specifies a new IS-IS option (Point-to-Point Three-Way Adjacency) that contains the System ID of the adjacent device, allowing IS-IS routers to verify they have a two-way communication. Modern IS-IS implementations use the three-way handshake by default. Still, you might have to turn it off to interoperate with an older device (or a device with ancient defaults) with an interface command similar to no isis three-way-handshake 16 . Warning A mismatch in the three-way handshake setting could have bizarre results. For example, turning it off on a FRRouting device results in one of the neighbors having a fully operational IS-IS adjacency while, at the same time, the other neighbor claims it can see no neighbors. To make matters worse, that often happens only after the IS-IS adjacency has been lost and would have to be re-established. As the last task in this lab, try out how your devices react to a three-way-handshake mismatch (assuming you can configure it): Turn it off on one of the routers. Clear the IS-IS adjacency with a command similar to clear isis neighbor Enjoy the confusing logging messages. Next: Using IS-IS Metrics Optimize Simple IS-IS Deployments","title":"Three-Way Handshake"},{"location":"basic/3-p2p/#reference-information","text":"","title":"Reference Information"},{"location":"basic/3-p2p/#lab-wiring","text":"Origin Device Origin Port Destination Device Destination Port r1 eth1 r2 eth1","title":"Lab Wiring"},{"location":"basic/3-p2p/#lab-addressing","text":"Node/Interface IPv4 Address IPv6 Address Description r1 10.0.0.1/32 Loopback eth1 10.1.0.1/30 r1 -> r2 r2 10.0.0.2/32 Loopback eth1 10.1.0.2/30 r2 -> r1 Like OSPF, the election process considers router priority and its System ID. \u21a9 Intermediate System is an OSI-compliant word for a router. OSPF would call DIS a DR. \u21a9 And consequently, the overall convergence time after a link recovery. \u21a9 DIS does not have the critical role that OSPF DR has. DIS is not responsible for the flooding of LSP changes; its only role is to help detect transmission errors by periodically sending table-of-contents (CSNP) of its LSPDB. \u21a9 Remember the nodeid octet in the LSP ID? That octet uniquely identifies a pseudonode originated by a DIS. The systemid in a pseudonode LSP is identical to the DIS systemid , making it very simple to identify the DIS. \u21a9 The pseudonode LSP is very similar to OSPF type-2 LSA. \u21a9 The LSP ID of the LAN pseudonode depends on the implementation \u21a9 A star topology with the pseudonode LSP in the middle as opposed to a full mesh topology \u21a9 The proof is left as an exercise for the reader. \u21a9 A major exception: routers connected to a Carrier Ethernet E-LAN service. \u21a9 The devices also known as layer-3 switches in marketing collaterals. \u21a9 On many network devices, you must enable message logging on terminal sessions with a command similar to terminal monitor . \u21a9 FRR printouts are a bit inconsistent. Router names are displayed in high-level printouts, while the detailed printouts contain system IDs. Use the show isis hostname command to display the mapping between system IDs and hostnames. \u21a9 IS-IS hello packets on multi-access media (as well as OSPF) always had a field specifying IS-IS neighbors a router can see. For whatever reason, that field was not present in the original specification of IS-IS hello packets used on point-to-point links. \u21a9 See the introduction section of RFC 5303 for more details. \u21a9 RFC 5303 was published in 2008, and recent IS-IS implementations, for example, Arista EOS, no longer have that nerd knob. \u21a9","title":"Lab Addressing"},{"location":"basic/4-metric/","text":"Using IS-IS Metrics Like OSPF, IS-IS uses interface costs (called link metrics ) to calculate the best path toward destination IP prefixes. Unlike OSPF, the default metrics are fixed (usually set to 10) and do not reflect the interface bandwidth. For example, in the following topology, using the default IS-IS settings, the traffic between R1 and R3 would use the direct low-speed link. We\u2019ll fix that in this lab exercise. Device Requirements Use any device supported by the netlab IS-IS configuration module . Starting the Lab Assuming you already set up your lab infrastructure : Change directory to basic/4-metric Execute netlab up Log into lab devices with netlab connect You\u2019ll get a lab with IPv4 addresses and basic IS-IS configurations on all devices. According to the recommendations from the Configure IS-IS Routing for IPv4 lab exercise, the routers are level-2-only routers, and the links are configured as point-to-point links. Initial Routing Tables Check the routing tables on R1 and R3 and verify that they use the direct (low-bandwidth) link. R1 should use the first Ethernet interface to reach R2 and the second Ethernet interface to reach R3. This is the printout you should get on FRRouting 1 : r1# show ip route 10.0.0.0/24 longer-prefixes Codes: K - kernel route, C - connected, L - local, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure L * 10.0.0.1/32 is directly connected, lo, 00:00:58 C>* 10.0.0.1/32 is directly connected, lo, 00:00:58 I>* 10.0.0.2/32 [115/20] via 10.1.0.2, eth1, weight 1, 00:00:55 I>* 10.0.0.3/32 [115/20] via 10.1.0.10, eth2, weight 1, 00:00:55 The cost to reach 10.0.0.2/32 and 10.0.0.3/32 is 20 (when using FRRouting): The cost of the connection between R1 and R2 (or R1 and R3) is 10. R2 and R3 advertise the loopback prefixes with a cost of 10 (this detail may vary across different implementations). You can check these details in the IS-IS topology database: R1 LSP \u2013 note the Extended Reachability metric toward R2 and R3 r1# show isis database detail r1.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 112 0x00000003 0xc5aa 1093 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: r1 TE Router ID: 10.0.0.1 Router Capability: 10.0.0.1 , D:0, S:0 Extended Reachability: 0000.0000.0002.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 10) IPv4 Interface Address: 10.0.0.1 Extended IP Reachability: 10.0.0.1/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.8/30 (Metric: 10) R2 LSP \u2013 note the Extended IP Reachability metric for 10.0.0.2/32 r1# show isis database detail r2.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r2.00-00 112 0x00000003 0xfb73 1049 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: r2 TE Router ID: 10.0.0.2 Router Capability: 10.0.0.2 , D:0, S:0 Extended Reachability: 0000.0000.0001.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 10) IPv4 Interface Address: 10.0.0.2 Extended IP Reachability: 10.0.0.2/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10) Changing the IS-IS Interface Metric You can change the IS-IS interface metric with an interface configuration command similar to isis metric 2 . Change the metric on the R1-R3 link to 50 (you must make the change on both ends). Verifying the Change After the change, R1 should use the first Ethernet interface to reach R3\u2019s loopback address. This is the printout you should get on FRRouting: r1# show ip route 10.0.0.0/24 longer-prefixes Codes: K - kernel route, C - connected, L - local, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure L * 10.0.0.1/32 is directly connected, lo, 00:32:08 C>* 10.0.0.1/32 is directly connected, lo, 00:32:08 I>* 10.0.0.2/32 [115/20] via 10.1.0.2, eth1, weight 1, 00:32:05 I>* 10.0.0.3/32 [115/30] via 10.1.0.2, eth1, weight 1, 00:02:53 Narrow, Wide, and Transitional Metrics Did you notice the Extended Reachability and Extended IP Reachability headings in the LSP printouts? Here\u2019s the full story: Original IS-IS specifications had 6-bit metrics (1-63), and the end-to-end cost ( path cost ) could not exceed 1023 3 . Today, we call those metrics narrow metrics. When large ISPs started using IS-IS, they quickly discovered that those limits were ridiculous. RFC 3784 defined 24-bit metrics (we call them wide metrics). That\u2019s what most deployments use today. All existing IS-IS networks that wanted to use the wide metrics had to transition from narrow to wide metrics, usually while keeping the network operational. The solution was to advertise both sets of metrics until all network devices understand wide metrics. Some vendors call that approach transition metrics. Tip I haven\u2019t seen an IS-IS implementation that doesn\u2019t understand the narrow metrics, and all recent implementations support wide metrics (they\u2019ve been around for 20 years). Sadly, many devices use narrow metrics as the default; you should immediately change that to wide . Warning You\u2019ll get weird results if some devices in your network support only narrow metrics while others advertise only wide metrics. If you have devices that do not understand the wide metrics, keep using the narrow metrics; otherwise, ensure all devices use only wide metrics. Let\u2019s try to reproduce the world we lived in around the turn of the millennium. FRRouting has a metric-style router configuration command. Let\u2019s set it to narrow on R1 and see what happens to the R1 LSP: r1# show isis database detail r1.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 116 0x00000005 0x4857 1781 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 IS Reachability: 0000.0000.0002.00 (Metric: 10) IS Reachability: 0000.0000.0003.00 (Metric: 50) Hostname: r1 Router Capability: 10.0.0.1 , D:0, S:0 IP Reachability: 10.0.0.1/32 (Metric: 10) IP Reachability: 10.1.0.0/30 (Metric: 10) IP Reachability: 10.1.0.8/30 (Metric: 50) IPv4 Interface Address: 10.0.0.1 As you can see, R1 replaced the Extended Reachability metric with the IS Reachability metric and the Extended IP Reachability metric with the IP Reachability metric . It also wouldn\u2019t allow you to increase the metric on the R1-R3 link above 63. Finally, let\u2019s set the metric style to transition and observe the changes in R1 LSP. As expected, the LSP contains two sets of metrics for every link and IP prefix. r1# sh isis database detail r1.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 175 0x0000000a 0x7dab 1785 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 IS Reachability: 0000.0000.0002.00 (Metric: 10) IS Reachability: 0000.0000.0003.00 (Metric: 50) Hostname: r1 TE Router ID: 10.0.0.1 Router Capability: 10.0.0.1 , D:0, S:0 Extended Reachability: 0000.0000.0002.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 50) IP Reachability: 10.0.0.1/32 (Metric: 10) IP Reachability: 10.1.0.0/30 (Metric: 10) IP Reachability: 10.1.0.8/30 (Metric: 50) IPv4 Interface Address: 10.0.0.1 Extended IP Reachability: 10.0.0.1/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.8/30 (Metric: 50) And now you know the whole story behind the IS-IS metric types. I hope you\u2019ll never see narrow or transition metric styles in a live network, and if you do (for example, due to ancient vendor defaults), consider changing that to wide . Next: Dual-Stack (IPv4+IPv6) IS-IS Routing Reference Information Lab Wiring Origin Device Origin Port Destination Device Destination Port r1 eth1 r2 eth1 r2 eth2 r3 eth1 r1 eth2 r3 eth2 Lab Addressing Node/Interface IPv4 Address IPv6 Address Description r1 10.0.0.1/32 Loopback eth1 10.1.0.1/30 r1 -> r2 eth2 10.1.0.9/30 r1 -> r3 r2 10.0.0.2/32 Loopback eth1 10.1.0.2/30 r2 -> r1 eth2 10.1.0.5/30 r2 -> r3 r3 10.0.0.3/32 Loopback eth1 10.1.0.6/30 r3 -> r2 eth2 10.1.0.10/30 r3 -> r1 I\u2019m using the show ip route longer-prefixes command to display just the loopbacks that happen to be in the 10.0.0.0/24 address space. \u21a9 IS-IS can use different metrics for L1 and L2 adjacencies. Don\u2019t waste your time on that detail, and I hope you\u2019ll never see a network using it outside of a CCIE lab. \u21a9 Someone had a great idea that you could optimize the SPF algorithm if the metric is small enough to be used as an index of a reasonably sized table. \u21a9","title":"Using IS-IS Metrics"},{"location":"basic/4-metric/#using-is-is-metrics","text":"Like OSPF, IS-IS uses interface costs (called link metrics ) to calculate the best path toward destination IP prefixes. Unlike OSPF, the default metrics are fixed (usually set to 10) and do not reflect the interface bandwidth. For example, in the following topology, using the default IS-IS settings, the traffic between R1 and R3 would use the direct low-speed link. We\u2019ll fix that in this lab exercise.","title":"Using IS-IS Metrics"},{"location":"basic/4-metric/#device-requirements","text":"Use any device supported by the netlab IS-IS configuration module .","title":"Device Requirements"},{"location":"basic/4-metric/#starting-the-lab","text":"Assuming you already set up your lab infrastructure : Change directory to basic/4-metric Execute netlab up Log into lab devices with netlab connect You\u2019ll get a lab with IPv4 addresses and basic IS-IS configurations on all devices. According to the recommendations from the Configure IS-IS Routing for IPv4 lab exercise, the routers are level-2-only routers, and the links are configured as point-to-point links.","title":"Starting the Lab"},{"location":"basic/4-metric/#initial-routing-tables","text":"Check the routing tables on R1 and R3 and verify that they use the direct (low-bandwidth) link. R1 should use the first Ethernet interface to reach R2 and the second Ethernet interface to reach R3. This is the printout you should get on FRRouting 1 : r1# show ip route 10.0.0.0/24 longer-prefixes Codes: K - kernel route, C - connected, L - local, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure L * 10.0.0.1/32 is directly connected, lo, 00:00:58 C>* 10.0.0.1/32 is directly connected, lo, 00:00:58 I>* 10.0.0.2/32 [115/20] via 10.1.0.2, eth1, weight 1, 00:00:55 I>* 10.0.0.3/32 [115/20] via 10.1.0.10, eth2, weight 1, 00:00:55 The cost to reach 10.0.0.2/32 and 10.0.0.3/32 is 20 (when using FRRouting): The cost of the connection between R1 and R2 (or R1 and R3) is 10. R2 and R3 advertise the loopback prefixes with a cost of 10 (this detail may vary across different implementations). You can check these details in the IS-IS topology database: R1 LSP \u2013 note the Extended Reachability metric toward R2 and R3 r1# show isis database detail r1.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 112 0x00000003 0xc5aa 1093 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: r1 TE Router ID: 10.0.0.1 Router Capability: 10.0.0.1 , D:0, S:0 Extended Reachability: 0000.0000.0002.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 10) IPv4 Interface Address: 10.0.0.1 Extended IP Reachability: 10.0.0.1/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.8/30 (Metric: 10) R2 LSP \u2013 note the Extended IP Reachability metric for 10.0.0.2/32 r1# show isis database detail r2.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r2.00-00 112 0x00000003 0xfb73 1049 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: r2 TE Router ID: 10.0.0.2 Router Capability: 10.0.0.2 , D:0, S:0 Extended Reachability: 0000.0000.0001.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 10) IPv4 Interface Address: 10.0.0.2 Extended IP Reachability: 10.0.0.2/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10)","title":"Initial Routing Tables"},{"location":"basic/4-metric/#changing-the-is-is-interface-metric","text":"You can change the IS-IS interface metric with an interface configuration command similar to isis metric 2 . Change the metric on the R1-R3 link to 50 (you must make the change on both ends).","title":"Changing the IS-IS Interface Metric"},{"location":"basic/4-metric/#verifying-the-change","text":"After the change, R1 should use the first Ethernet interface to reach R3\u2019s loopback address. This is the printout you should get on FRRouting: r1# show ip route 10.0.0.0/24 longer-prefixes Codes: K - kernel route, C - connected, L - local, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure L * 10.0.0.1/32 is directly connected, lo, 00:32:08 C>* 10.0.0.1/32 is directly connected, lo, 00:32:08 I>* 10.0.0.2/32 [115/20] via 10.1.0.2, eth1, weight 1, 00:32:05 I>* 10.0.0.3/32 [115/30] via 10.1.0.2, eth1, weight 1, 00:02:53","title":"Verifying the Change"},{"location":"basic/4-metric/#narrow-wide-and-transitional-metrics","text":"Did you notice the Extended Reachability and Extended IP Reachability headings in the LSP printouts? Here\u2019s the full story: Original IS-IS specifications had 6-bit metrics (1-63), and the end-to-end cost ( path cost ) could not exceed 1023 3 . Today, we call those metrics narrow metrics. When large ISPs started using IS-IS, they quickly discovered that those limits were ridiculous. RFC 3784 defined 24-bit metrics (we call them wide metrics). That\u2019s what most deployments use today. All existing IS-IS networks that wanted to use the wide metrics had to transition from narrow to wide metrics, usually while keeping the network operational. The solution was to advertise both sets of metrics until all network devices understand wide metrics. Some vendors call that approach transition metrics. Tip I haven\u2019t seen an IS-IS implementation that doesn\u2019t understand the narrow metrics, and all recent implementations support wide metrics (they\u2019ve been around for 20 years). Sadly, many devices use narrow metrics as the default; you should immediately change that to wide . Warning You\u2019ll get weird results if some devices in your network support only narrow metrics while others advertise only wide metrics. If you have devices that do not understand the wide metrics, keep using the narrow metrics; otherwise, ensure all devices use only wide metrics. Let\u2019s try to reproduce the world we lived in around the turn of the millennium. FRRouting has a metric-style router configuration command. Let\u2019s set it to narrow on R1 and see what happens to the R1 LSP: r1# show isis database detail r1.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 116 0x00000005 0x4857 1781 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 IS Reachability: 0000.0000.0002.00 (Metric: 10) IS Reachability: 0000.0000.0003.00 (Metric: 50) Hostname: r1 Router Capability: 10.0.0.1 , D:0, S:0 IP Reachability: 10.0.0.1/32 (Metric: 10) IP Reachability: 10.1.0.0/30 (Metric: 10) IP Reachability: 10.1.0.8/30 (Metric: 50) IPv4 Interface Address: 10.0.0.1 As you can see, R1 replaced the Extended Reachability metric with the IS Reachability metric and the Extended IP Reachability metric with the IP Reachability metric . It also wouldn\u2019t allow you to increase the metric on the R1-R3 link above 63. Finally, let\u2019s set the metric style to transition and observe the changes in R1 LSP. As expected, the LSP contains two sets of metrics for every link and IP prefix. r1# sh isis database detail r1.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 175 0x0000000a 0x7dab 1785 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 IS Reachability: 0000.0000.0002.00 (Metric: 10) IS Reachability: 0000.0000.0003.00 (Metric: 50) Hostname: r1 TE Router ID: 10.0.0.1 Router Capability: 10.0.0.1 , D:0, S:0 Extended Reachability: 0000.0000.0002.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 50) IP Reachability: 10.0.0.1/32 (Metric: 10) IP Reachability: 10.1.0.0/30 (Metric: 10) IP Reachability: 10.1.0.8/30 (Metric: 50) IPv4 Interface Address: 10.0.0.1 Extended IP Reachability: 10.0.0.1/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.8/30 (Metric: 50) And now you know the whole story behind the IS-IS metric types. I hope you\u2019ll never see narrow or transition metric styles in a live network, and if you do (for example, due to ancient vendor defaults), consider changing that to wide . Next: Dual-Stack (IPv4+IPv6) IS-IS Routing","title":"Narrow, Wide, and Transitional Metrics"},{"location":"basic/4-metric/#reference-information","text":"","title":"Reference Information"},{"location":"basic/4-metric/#lab-wiring","text":"Origin Device Origin Port Destination Device Destination Port r1 eth1 r2 eth1 r2 eth2 r3 eth1 r1 eth2 r3 eth2","title":"Lab Wiring"},{"location":"basic/4-metric/#lab-addressing","text":"Node/Interface IPv4 Address IPv6 Address Description r1 10.0.0.1/32 Loopback eth1 10.1.0.1/30 r1 -> r2 eth2 10.1.0.9/30 r1 -> r3 r2 10.0.0.2/32 Loopback eth1 10.1.0.2/30 r2 -> r1 eth2 10.1.0.5/30 r2 -> r3 r3 10.0.0.3/32 Loopback eth1 10.1.0.6/30 r3 -> r2 eth2 10.1.0.10/30 r3 -> r1 I\u2019m using the show ip route longer-prefixes command to display just the loopbacks that happen to be in the 10.0.0.0/24 address space. \u21a9 IS-IS can use different metrics for L1 and L2 adjacencies. Don\u2019t waste your time on that detail, and I hope you\u2019ll never see a network using it outside of a CCIE lab. \u21a9 Someone had a great idea that you could optimize the SPF algorithm if the metric is small enough to be used as an index of a reasonably sized table. \u21a9","title":"Lab Addressing"},{"location":"basic/5-ipv6/","text":"Dual-Stack (IPv4+IPv6) IS-IS Routing Adding IPv6 support to IS-IS seems like a no-brainer. The data structures describing the network topology are extensible, and we already have TLVs for links and IPv4 prefixes. Let\u2019s add IPv6 prefixes and call it a day. That\u2019s the approach taken by RFC 5308 . Unfortunately, the devil usually hides in the seemingly irrelevant details, and we\u2019ll explore those in this lab exercise. We\u2019ll use a very simple topology with three routers. The only quirk is the addressing on the R2-R3 link; while all three routers have an IPv6 address configured on their loopback interface, the R2-R3 link does not run IPv6. Device Requirements Use any device supported by the netlab IS-IS configuration module . Starting the Lab Assuming you already set up your lab infrastructure : Change directory to basic/5-ipv6 Execute netlab up Log into lab devices with netlab connect You\u2019ll get a lab with: IPv4 and IPv6 addresses on loopback interfaces IS-IS configured for IPv4 routing IPv6 LLA configured on the R1-R2 link but not on the R2-R3 link. Initial Routing Tables Check the routing tables on R1 and verify that it can reach the loopback interfaces of R2 and R3. You should get these printouts on FRRouting and Arista EOS: The IPv4 routing table on R1 running FRRouting r1# show ip route Codes: K - kernel route, C - connected, L - local, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure L * 10.0.0.1/32 is directly connected, lo, 00:00:21 C>* 10.0.0.1/32 is directly connected, lo, 00:00:21 I>* 10.0.0.2/32 [115/20] via 10.1.0.2, eth1, weight 1, 00:00:17 I>* 10.0.0.3/32 [115/30] via 10.1.0.2, eth1, weight 1, 00:00:17 I 10.1.0.0/30 [115/20] via 10.1.0.2, eth1 inactive, weight 1, 00:00:17 C>* 10.1.0.0/30 is directly connected, eth1, 00:00:21 L>* 10.1.0.1/32 is directly connected, eth1, 00:00:21 I>* 10.1.0.4/30 [115/20] via 10.1.0.2, eth1, weight 1, 00:00:17 The IPv4 routing table on R1 running Arista EOS r1>show ip route | begin Gateway Gateway of last resort is not set C 10.0.0.1/32 directly connected, Loopback0 I L2 10.0.0.2/32 [115/20] via 10.1.0.2, Ethernet1 I L2 10.0.0.3/32 [115/30] via 10.1.0.2, Ethernet1 C 10.1.0.0/30 directly connected, Ethernet1 I L2 10.1.0.4/30 [115/20] via 10.1.0.2, Ethernet1 Check also the IPv6 routing tables. Each router should have only its loopback IPv6 prefix in the IPv6 routing table: The IPv6 routing table on R1 running FRRouting r1# show ipv6 route Codes: K - kernel route, C - connected, L - local, S - static, R - RIPng, O - OSPFv3, I - IS-IS, B - BGP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure C>* 2001:db8:cafe:1::/64 is directly connected, lo, 00:00:31 L>* 2001:db8:cafe:1::1/128 is directly connected, lo, 00:00:31 C>* fe80::/64 is directly connected, eth1, 00:00:30 The IPv6 routing table on R1 running Arista EOS r1>show ipv6 route VRF: default Displaying 1 of 5 IPv6 routing table entries Source Codes: C - connected, S - static, K - kernel, O3 - OSPFv3, B - Other BGP Routes, A B - BGP Aggregate, R - RIP, I L1 - IS-IS level 1, I L2 - IS-IS level 2, DH - DHCP, NG - Nexthop Group Static Route, M - Martian, DP - Dynamic Policy Route, L - VRF Leaked, G - gRIBI, RC - Route Cache Route, CL - CBF Leaked Route C 2001:db8:cafe:1::/64 [0/0] via Loopback0, directly connected Configure IS-IS for IPv6 Routing Enabling IPv6 routing on an existing IS-IS instance is trivial. Some devices (for example, FRRouting) expect you to do it on individual interfaces (including the loopback interfaces) with a command similar to ipv6 router isis ; other devices (for example, Arista EOS) require you to configure the IPv6 address family within the IS-IS routing process without changing the interface configuration ( address-family ipv6 is a typical command to use) 1 . Depending on which devices you use in your lab, configure IPv6 IS-IS routing on all links with IPv6 addresses or IPv6 address family in the IS-IS routing process on all routers. The Confusing Results If you\u2019re using Arista EOS in your lab, you\u2019ll notice that R2 no longer wants to have R3 as its IS-IS neighbor. Arista EOS is very strict and forms IS-IS adjacencies only over interfaces with addresses from all address families configured in the IS-IS routing process. IS-IS neighbors on R2 running Arista EOS r2#show isis neighbors Instance VRF System Id Type Interface SNPA State Hold time Circuit Id Gandalf default r1 L2 Ethernet1 P2P UP 25 60 If you find that too strict, let\u2019s see what happens on devices that use a more relaxed approach. Start the lab with FRRouting devices and enable IS-IS for IPv6 (hint: ipv6 router isis ) on all interfaces with IPv6 addresses. After doing that, R2 should still have adjacencies with R3 and R1: IS-IS neighbors on R2 running FRRouting r2# show isis neighbor Area Gandalf: System Id Interface L State Holdtime SNPA r1 eth1 2 Up 28 2020.2020.2020 r3 eth2 2 Up 28 2020.2020.2020 However, even though R3 advertises its loopback IPv6 prefix in its LSP, R2 does not have the IPv6 prefix of R3\u2019s loopback in its IPv6 routing table: The LSP advertised by R3 r2# show isis database detail r3.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r3.00-00 109 0x00000004 0xa092 1713 0/0/0 Protocols Supported: IPv4, IPv6 Area Address: 49.0001 Hostname: r3 TE Router ID: 10.0.0.3 Router Capability: 10.0.0.3 , D:0, S:0 Extended Reachability: 0000.0000.0002.00 (Metric: 10) IPv4 Interface Address: 10.0.0.3 Extended IP Reachability: 10.0.0.3/32 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10) IPv6 Reachability: 2001:db8:cafe:3::/64 (Metric: 10) The IPv6 routing table on R2 (FRRouting) r2# show ipv6 route Codes: K - kernel route, C - connected, L - local, S - static, R - RIPng, O - OSPFv3, I - IS-IS, B - BGP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure I>* 2001:db8:cafe:1::/64 [115/20] via fe80::a8c1:abff:fed7:a0ce, eth1, weight 1, 00:00:47 C>* 2001:db8:cafe:2::/64 is directly connected, lo, 00:24:45 L>* 2001:db8:cafe:2::1/128 is directly connected, lo, 00:24:45 C>* fe80::/64 is directly connected, eth1, 00:24:44 How does R2 know that it can use the link to R3 for IPv4 traffic but not for IPv6 traffic? The lack of an IPv6 interface address is the first hint, as are the IS-IS hello messages. Every IS-IS router advertises the address families configured on an interface in the IS-IS hello messages sent over that interface. You can use a command similar to show isis neighbor detail to check that: The IS-IS neighbors visible to R2 (FRRouting) r2# show isis neighbor detail Area Gandalf: r1 Interface: eth1, Level: 2, State: Up, Expires in 30s Adjacency flaps: 1, Last: 27m13s ago Circuit type: L2, Speaks: IPv4, IPv6 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.1 IPv6 Address(es): fe80::a8c1:abff:fed7:a0ce r3 Interface: eth2, Level: 2, State: Up, Expires in 27s Adjacency flaps: 1, Last: 27m13s ago Circuit type: L2, Speaks: IPv4 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.6 Unfortunately, there is no way to propagate the information from the IS-IS hello packets to other routers in the network. R1 thinks it can safely use R2 to reach the IPv6 loopback address of R3 even though the R2-R3 link carries only IPv4 traffic: The IPv6 routing table on R1 (FRRouting) r1# show ipv6 route Codes: K - kernel route, C - connected, L - local, S - static, R - RIPng, O - OSPFv3, I - IS-IS, B - BGP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure C>* 2001:db8:cafe:1::/64 is directly connected, lo, 00:29:09 L>* 2001:db8:cafe:1::1/128 is directly connected, lo, 00:29:09 I>* 2001:db8:cafe:2::/64 [115/20] via fe80::a8c1:abff:fe04:e9f6, eth1, weight 1, 00:05:11 I>* 2001:db8:cafe:3::/64 [115/30] via fe80::a8c1:abff:fe04:e9f6, eth1, weight 1, 00:05:11 C>* fe80::/64 is directly connected, eth1, 00:29:08 Takeaway: You can get black holes in your network as soon as a single link in an IS-IS domain does not forward the traffic for all address families configured in IS-IS. Multi-Topology Routing The solution to the above conundrum is to use multiple network topologies within a single IS-IS process (multi-topology IS-IS routing, defined in RFC 5120 ), effectively turning IS-IS into a combination of OSPFv2 and OSPFv3. Tip Multi-topology IS-IS is still better than a combination of OSPFv2 and OSPFv3. You\u2019re using a single routing protocol with a single adjacency/flooding mechanism and a unified data structure, whereas OSPFv2 and OSPFv3 have significant differences. Most IS-IS implementations do not use multi-topology routing by default. You have to enable it with a router configuration command similar to multi-topology (usually within the IPv6 address family) or with a topology ipv6-unicast router configuration command. Do that on all three lab devices. Validation After configuring multi-topology IS-IS routing on all routers in your lab, you should have: IS-IS adjacencies between R2 and R1/R3 Routes for all three IPv4 loopback addresses in the IPv4 routing tables of all routes Routes for IPv6 loopback prefixes on R1 and R2, but not on R3. R3 cannot participate in the IPv6 topology as it has no IPv6-enabled links with other routers. IS-IS neighbors on R2 r2# show isis neighbor Area Gandalf: System Id Interface L State Holdtime SNPA r1 eth1 2 Up 28 2020.2020.2020 r3 eth2 2 Up 27 2020.2020.2020 The routes for IPv4 loopbacks on R2 r2# show ip route 10.0.0.0/24 longer-prefixes Codes: K - kernel route, C - connected, L - local, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure I>* 10.0.0.1/32 [115/20] via 10.1.0.1, eth1, weight 1, 00:43:00 L * 10.0.0.2/32 is directly connected, lo, 00:43:04 C>* 10.0.0.2/32 is directly connected, lo, 00:43:04 I>* 10.0.0.3/32 [115/20] via 10.1.0.6, eth2, weight 1, 00:43:00 The IPv6 routing table on R2 r2# show ipv6 route Codes: K - kernel route, C - connected, L - local, S - static, R - RIPng, O - OSPFv3, I - IS-IS, B - BGP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure I>* 2001:db8:cafe:1::/64 [115/20] via fe80::a8c1:abff:fed7:a0ce, eth1, weight 1, 00:02:11 C>* 2001:db8:cafe:2::/64 is directly connected, lo, 00:43:33 L>* 2001:db8:cafe:2::1/128 is directly connected, lo, 00:43:33 C>* fe80::/64 is directly connected, eth1, 00:43:32 Next: Optimize Simple IS-IS Deployments Behind the Scenes Multi-topology IS-IS routing modifies two aspects of IS-IS. The IS-IS hello packets carry additional TLVs describing the topologies enabled on the sending router. You can see them if you inspect the IS-IS neighbor details: Multi-topology IS-IS neighbors (FRRouting) r2# show isis neighbor detail Area Gandalf: r1 Interface: eth1, Level: 2, State: Up, Expires in 27s Adjacency flaps: 1, Last: 45m9s ago Circuit type: L2, Speaks: IPv4, IPv6 Topologies: standard ipv6-unicast SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.1 IPv6 Address(es): fe80::a8c1:abff:fed7:a0ce r3 Interface: eth2, Level: 2, State: Up, Expires in 29s Adjacency flaps: 1, Last: 45m9s ago Circuit type: L2, Speaks: IPv4 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.6 Tip Even though we configured the IPv6 topology on R3, it does not advertise that topology over an IPv4-only interface. Multi-topology IS-IS neighbors (Arista EOS) r2#show isis nei detail Instance VRF System Id Type Interface SNPA State Hold time Circuit Id Gandalf default r1 L2 Ethernet1 P2P UP 27 60 Area addresses: 49.0001 SNPA: P2P Router ID: 0.0.0.0 Advertised Hold Time: 30 State Changed: 00:00:31 ago at 2024-08-19 13:30:06 IPv4 Interface Address: 10.1.0.1 IPv6 Interface Address: fe80::50dc:caff:fefe:101 Interface name: Ethernet1 Graceful Restart: Supported Supported Address Families: IPv4, IPv6 Neighbor Supported Address Families: IPv4, IPv6 Gandalf default r3 L2 Ethernet2 P2P UP 22 62 Area addresses: 49.0001 SNPA: P2P Router ID: 0.0.0.0 Advertised Hold Time: 30 State Changed: 00:00:08 ago at 2024-08-19 13:30:29 IPv4 Interface Address: 10.1.0.6 IPv6 Interface Address: none Interface name: Ethernet2 Graceful Restart: Supported Supported Address Families: IPv4 Neighbor Supported Address Families: IPv4 Warning Arista EOS is very strict in its checking of IS-IS hellos. The adjacency between R2 and R3 is not established until you configure multi-topology IS-IS on R3, even though the link between R2 and R3 supports only IPv4. The change to the LSPs is even more important. Every router is advertising the topologies it has in its LSP, as well as per-topology links using Extended Reachability (wide metrics) for IPv4-enabled links and Multi-Topology Reachability for IPv6-enabled links. The LSP advertised by R2 using IPv6 topology (FRRouting) r2# show isis database detail r2.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r2.00-00 * 152 0x00000008 0xed0b 1415 0/0/0 Protocols Supported: IPv4, IPv6 Area Address: 49.0001 MT Router Info: ipv4-unicast MT Router Info: ipv6-unicast Hostname: r2 TE Router ID: 10.0.0.2 Router Capability: 10.0.0.2 , D:0, S:0 Extended Reachability: 0000.0000.0001.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 10) MT Reachability: 0000.0000.0001.00 (Metric: 10) ipv6-unicast IPv4 Interface Address: 10.0.0.2 Extended IP Reachability: 10.0.0.2/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10) MT IPv6 Reachability: 2001:db8:cafe:2::/64 (Metric: 10) ipv6-unicast The per-protocol neighbor reachability information allows routers to run the SPF algorithm for individual address families. The algorithm can then discard useless links (for an address family) while building the shortest path tree. Takeaway: Use multi-topology IS-IS routing in multiprotocol networks unless you can guarantee that all links use the same address families (or love late-night troubleshooting sessions). Reference Information Lab Wiring Origin Device Origin Port Destination Device Destination Port r1 eth1 r2 eth1 r2 eth2 r3 eth1 Lab Addressing Node/Interface IPv4 Address IPv6 Address Description r1 10.0.0.1/32 2001:db8:cafe:1::1/64 Loopback eth1 10.1.0.1/30 LLA r1 -> r2 r2 10.0.0.2/32 2001:db8:cafe:2::1/64 Loopback eth1 10.1.0.2/30 LLA r2 -> r1 eth2 10.1.0.5/30 r2 -> r3 r3 10.0.0.3/32 2001:db8:cafe:3::1/64 Loopback eth1 10.1.0.6/30 r3 -> r2 I\u2019m positive you have to do both on some devices ;) \u21a9","title":"Dual-Stack (IPv4+IPv6) IS-IS Routing"},{"location":"basic/5-ipv6/#dual-stack-ipv4ipv6-is-is-routing","text":"Adding IPv6 support to IS-IS seems like a no-brainer. The data structures describing the network topology are extensible, and we already have TLVs for links and IPv4 prefixes. Let\u2019s add IPv6 prefixes and call it a day. That\u2019s the approach taken by RFC 5308 . Unfortunately, the devil usually hides in the seemingly irrelevant details, and we\u2019ll explore those in this lab exercise. We\u2019ll use a very simple topology with three routers. The only quirk is the addressing on the R2-R3 link; while all three routers have an IPv6 address configured on their loopback interface, the R2-R3 link does not run IPv6.","title":"Dual-Stack (IPv4+IPv6) IS-IS Routing"},{"location":"basic/5-ipv6/#device-requirements","text":"Use any device supported by the netlab IS-IS configuration module .","title":"Device Requirements"},{"location":"basic/5-ipv6/#starting-the-lab","text":"Assuming you already set up your lab infrastructure : Change directory to basic/5-ipv6 Execute netlab up Log into lab devices with netlab connect You\u2019ll get a lab with: IPv4 and IPv6 addresses on loopback interfaces IS-IS configured for IPv4 routing IPv6 LLA configured on the R1-R2 link but not on the R2-R3 link.","title":"Starting the Lab"},{"location":"basic/5-ipv6/#initial-routing-tables","text":"Check the routing tables on R1 and verify that it can reach the loopback interfaces of R2 and R3. You should get these printouts on FRRouting and Arista EOS: The IPv4 routing table on R1 running FRRouting r1# show ip route Codes: K - kernel route, C - connected, L - local, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure L * 10.0.0.1/32 is directly connected, lo, 00:00:21 C>* 10.0.0.1/32 is directly connected, lo, 00:00:21 I>* 10.0.0.2/32 [115/20] via 10.1.0.2, eth1, weight 1, 00:00:17 I>* 10.0.0.3/32 [115/30] via 10.1.0.2, eth1, weight 1, 00:00:17 I 10.1.0.0/30 [115/20] via 10.1.0.2, eth1 inactive, weight 1, 00:00:17 C>* 10.1.0.0/30 is directly connected, eth1, 00:00:21 L>* 10.1.0.1/32 is directly connected, eth1, 00:00:21 I>* 10.1.0.4/30 [115/20] via 10.1.0.2, eth1, weight 1, 00:00:17 The IPv4 routing table on R1 running Arista EOS r1>show ip route | begin Gateway Gateway of last resort is not set C 10.0.0.1/32 directly connected, Loopback0 I L2 10.0.0.2/32 [115/20] via 10.1.0.2, Ethernet1 I L2 10.0.0.3/32 [115/30] via 10.1.0.2, Ethernet1 C 10.1.0.0/30 directly connected, Ethernet1 I L2 10.1.0.4/30 [115/20] via 10.1.0.2, Ethernet1 Check also the IPv6 routing tables. Each router should have only its loopback IPv6 prefix in the IPv6 routing table: The IPv6 routing table on R1 running FRRouting r1# show ipv6 route Codes: K - kernel route, C - connected, L - local, S - static, R - RIPng, O - OSPFv3, I - IS-IS, B - BGP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure C>* 2001:db8:cafe:1::/64 is directly connected, lo, 00:00:31 L>* 2001:db8:cafe:1::1/128 is directly connected, lo, 00:00:31 C>* fe80::/64 is directly connected, eth1, 00:00:30 The IPv6 routing table on R1 running Arista EOS r1>show ipv6 route VRF: default Displaying 1 of 5 IPv6 routing table entries Source Codes: C - connected, S - static, K - kernel, O3 - OSPFv3, B - Other BGP Routes, A B - BGP Aggregate, R - RIP, I L1 - IS-IS level 1, I L2 - IS-IS level 2, DH - DHCP, NG - Nexthop Group Static Route, M - Martian, DP - Dynamic Policy Route, L - VRF Leaked, G - gRIBI, RC - Route Cache Route, CL - CBF Leaked Route C 2001:db8:cafe:1::/64 [0/0] via Loopback0, directly connected","title":"Initial Routing Tables"},{"location":"basic/5-ipv6/#configure-is-is-for-ipv6-routing","text":"Enabling IPv6 routing on an existing IS-IS instance is trivial. Some devices (for example, FRRouting) expect you to do it on individual interfaces (including the loopback interfaces) with a command similar to ipv6 router isis ; other devices (for example, Arista EOS) require you to configure the IPv6 address family within the IS-IS routing process without changing the interface configuration ( address-family ipv6 is a typical command to use) 1 . Depending on which devices you use in your lab, configure IPv6 IS-IS routing on all links with IPv6 addresses or IPv6 address family in the IS-IS routing process on all routers.","title":"Configure IS-IS for IPv6 Routing"},{"location":"basic/5-ipv6/#the-confusing-results","text":"If you\u2019re using Arista EOS in your lab, you\u2019ll notice that R2 no longer wants to have R3 as its IS-IS neighbor. Arista EOS is very strict and forms IS-IS adjacencies only over interfaces with addresses from all address families configured in the IS-IS routing process. IS-IS neighbors on R2 running Arista EOS r2#show isis neighbors Instance VRF System Id Type Interface SNPA State Hold time Circuit Id Gandalf default r1 L2 Ethernet1 P2P UP 25 60 If you find that too strict, let\u2019s see what happens on devices that use a more relaxed approach. Start the lab with FRRouting devices and enable IS-IS for IPv6 (hint: ipv6 router isis ) on all interfaces with IPv6 addresses. After doing that, R2 should still have adjacencies with R3 and R1: IS-IS neighbors on R2 running FRRouting r2# show isis neighbor Area Gandalf: System Id Interface L State Holdtime SNPA r1 eth1 2 Up 28 2020.2020.2020 r3 eth2 2 Up 28 2020.2020.2020 However, even though R3 advertises its loopback IPv6 prefix in its LSP, R2 does not have the IPv6 prefix of R3\u2019s loopback in its IPv6 routing table: The LSP advertised by R3 r2# show isis database detail r3.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r3.00-00 109 0x00000004 0xa092 1713 0/0/0 Protocols Supported: IPv4, IPv6 Area Address: 49.0001 Hostname: r3 TE Router ID: 10.0.0.3 Router Capability: 10.0.0.3 , D:0, S:0 Extended Reachability: 0000.0000.0002.00 (Metric: 10) IPv4 Interface Address: 10.0.0.3 Extended IP Reachability: 10.0.0.3/32 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10) IPv6 Reachability: 2001:db8:cafe:3::/64 (Metric: 10) The IPv6 routing table on R2 (FRRouting) r2# show ipv6 route Codes: K - kernel route, C - connected, L - local, S - static, R - RIPng, O - OSPFv3, I - IS-IS, B - BGP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure I>* 2001:db8:cafe:1::/64 [115/20] via fe80::a8c1:abff:fed7:a0ce, eth1, weight 1, 00:00:47 C>* 2001:db8:cafe:2::/64 is directly connected, lo, 00:24:45 L>* 2001:db8:cafe:2::1/128 is directly connected, lo, 00:24:45 C>* fe80::/64 is directly connected, eth1, 00:24:44 How does R2 know that it can use the link to R3 for IPv4 traffic but not for IPv6 traffic? The lack of an IPv6 interface address is the first hint, as are the IS-IS hello messages. Every IS-IS router advertises the address families configured on an interface in the IS-IS hello messages sent over that interface. You can use a command similar to show isis neighbor detail to check that: The IS-IS neighbors visible to R2 (FRRouting) r2# show isis neighbor detail Area Gandalf: r1 Interface: eth1, Level: 2, State: Up, Expires in 30s Adjacency flaps: 1, Last: 27m13s ago Circuit type: L2, Speaks: IPv4, IPv6 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.1 IPv6 Address(es): fe80::a8c1:abff:fed7:a0ce r3 Interface: eth2, Level: 2, State: Up, Expires in 27s Adjacency flaps: 1, Last: 27m13s ago Circuit type: L2, Speaks: IPv4 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.6 Unfortunately, there is no way to propagate the information from the IS-IS hello packets to other routers in the network. R1 thinks it can safely use R2 to reach the IPv6 loopback address of R3 even though the R2-R3 link carries only IPv4 traffic: The IPv6 routing table on R1 (FRRouting) r1# show ipv6 route Codes: K - kernel route, C - connected, L - local, S - static, R - RIPng, O - OSPFv3, I - IS-IS, B - BGP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure C>* 2001:db8:cafe:1::/64 is directly connected, lo, 00:29:09 L>* 2001:db8:cafe:1::1/128 is directly connected, lo, 00:29:09 I>* 2001:db8:cafe:2::/64 [115/20] via fe80::a8c1:abff:fe04:e9f6, eth1, weight 1, 00:05:11 I>* 2001:db8:cafe:3::/64 [115/30] via fe80::a8c1:abff:fe04:e9f6, eth1, weight 1, 00:05:11 C>* fe80::/64 is directly connected, eth1, 00:29:08 Takeaway: You can get black holes in your network as soon as a single link in an IS-IS domain does not forward the traffic for all address families configured in IS-IS.","title":"The Confusing Results"},{"location":"basic/5-ipv6/#multi-topology-routing","text":"The solution to the above conundrum is to use multiple network topologies within a single IS-IS process (multi-topology IS-IS routing, defined in RFC 5120 ), effectively turning IS-IS into a combination of OSPFv2 and OSPFv3. Tip Multi-topology IS-IS is still better than a combination of OSPFv2 and OSPFv3. You\u2019re using a single routing protocol with a single adjacency/flooding mechanism and a unified data structure, whereas OSPFv2 and OSPFv3 have significant differences. Most IS-IS implementations do not use multi-topology routing by default. You have to enable it with a router configuration command similar to multi-topology (usually within the IPv6 address family) or with a topology ipv6-unicast router configuration command. Do that on all three lab devices.","title":"Multi-Topology Routing"},{"location":"basic/5-ipv6/#validation","text":"After configuring multi-topology IS-IS routing on all routers in your lab, you should have: IS-IS adjacencies between R2 and R1/R3 Routes for all three IPv4 loopback addresses in the IPv4 routing tables of all routes Routes for IPv6 loopback prefixes on R1 and R2, but not on R3. R3 cannot participate in the IPv6 topology as it has no IPv6-enabled links with other routers. IS-IS neighbors on R2 r2# show isis neighbor Area Gandalf: System Id Interface L State Holdtime SNPA r1 eth1 2 Up 28 2020.2020.2020 r3 eth2 2 Up 27 2020.2020.2020 The routes for IPv4 loopbacks on R2 r2# show ip route 10.0.0.0/24 longer-prefixes Codes: K - kernel route, C - connected, L - local, S - static, R - RIP, O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure I>* 10.0.0.1/32 [115/20] via 10.1.0.1, eth1, weight 1, 00:43:00 L * 10.0.0.2/32 is directly connected, lo, 00:43:04 C>* 10.0.0.2/32 is directly connected, lo, 00:43:04 I>* 10.0.0.3/32 [115/20] via 10.1.0.6, eth2, weight 1, 00:43:00 The IPv6 routing table on R2 r2# show ipv6 route Codes: K - kernel route, C - connected, L - local, S - static, R - RIPng, O - OSPFv3, I - IS-IS, B - BGP, N - NHRP, T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR, f - OpenFabric, t - Table-Direct, > - selected route, * - FIB route, q - queued, r - rejected, b - backup t - trapped, o - offload failure I>* 2001:db8:cafe:1::/64 [115/20] via fe80::a8c1:abff:fed7:a0ce, eth1, weight 1, 00:02:11 C>* 2001:db8:cafe:2::/64 is directly connected, lo, 00:43:33 L>* 2001:db8:cafe:2::1/128 is directly connected, lo, 00:43:33 C>* fe80::/64 is directly connected, eth1, 00:43:32 Next: Optimize Simple IS-IS Deployments","title":"Validation"},{"location":"basic/5-ipv6/#behind-the-scenes","text":"Multi-topology IS-IS routing modifies two aspects of IS-IS. The IS-IS hello packets carry additional TLVs describing the topologies enabled on the sending router. You can see them if you inspect the IS-IS neighbor details: Multi-topology IS-IS neighbors (FRRouting) r2# show isis neighbor detail Area Gandalf: r1 Interface: eth1, Level: 2, State: Up, Expires in 27s Adjacency flaps: 1, Last: 45m9s ago Circuit type: L2, Speaks: IPv4, IPv6 Topologies: standard ipv6-unicast SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.1 IPv6 Address(es): fe80::a8c1:abff:fed7:a0ce r3 Interface: eth2, Level: 2, State: Up, Expires in 29s Adjacency flaps: 1, Last: 45m9s ago Circuit type: L2, Speaks: IPv4 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.6 Tip Even though we configured the IPv6 topology on R3, it does not advertise that topology over an IPv4-only interface. Multi-topology IS-IS neighbors (Arista EOS) r2#show isis nei detail Instance VRF System Id Type Interface SNPA State Hold time Circuit Id Gandalf default r1 L2 Ethernet1 P2P UP 27 60 Area addresses: 49.0001 SNPA: P2P Router ID: 0.0.0.0 Advertised Hold Time: 30 State Changed: 00:00:31 ago at 2024-08-19 13:30:06 IPv4 Interface Address: 10.1.0.1 IPv6 Interface Address: fe80::50dc:caff:fefe:101 Interface name: Ethernet1 Graceful Restart: Supported Supported Address Families: IPv4, IPv6 Neighbor Supported Address Families: IPv4, IPv6 Gandalf default r3 L2 Ethernet2 P2P UP 22 62 Area addresses: 49.0001 SNPA: P2P Router ID: 0.0.0.0 Advertised Hold Time: 30 State Changed: 00:00:08 ago at 2024-08-19 13:30:29 IPv4 Interface Address: 10.1.0.6 IPv6 Interface Address: none Interface name: Ethernet2 Graceful Restart: Supported Supported Address Families: IPv4 Neighbor Supported Address Families: IPv4 Warning Arista EOS is very strict in its checking of IS-IS hellos. The adjacency between R2 and R3 is not established until you configure multi-topology IS-IS on R3, even though the link between R2 and R3 supports only IPv4. The change to the LSPs is even more important. Every router is advertising the topologies it has in its LSP, as well as per-topology links using Extended Reachability (wide metrics) for IPv4-enabled links and Multi-Topology Reachability for IPv6-enabled links. The LSP advertised by R2 using IPv6 topology (FRRouting) r2# show isis database detail r2.00-00 Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r2.00-00 * 152 0x00000008 0xed0b 1415 0/0/0 Protocols Supported: IPv4, IPv6 Area Address: 49.0001 MT Router Info: ipv4-unicast MT Router Info: ipv6-unicast Hostname: r2 TE Router ID: 10.0.0.2 Router Capability: 10.0.0.2 , D:0, S:0 Extended Reachability: 0000.0000.0001.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 10) MT Reachability: 0000.0000.0001.00 (Metric: 10) ipv6-unicast IPv4 Interface Address: 10.0.0.2 Extended IP Reachability: 10.0.0.2/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10) MT IPv6 Reachability: 2001:db8:cafe:2::/64 (Metric: 10) ipv6-unicast The per-protocol neighbor reachability information allows routers to run the SPF algorithm for individual address families. The algorithm can then discard useless links (for an address family) while building the shortest path tree. Takeaway: Use multi-topology IS-IS routing in multiprotocol networks unless you can guarantee that all links use the same address families (or love late-night troubleshooting sessions).","title":"Behind the Scenes"},{"location":"basic/5-ipv6/#reference-information","text":"","title":"Reference Information"},{"location":"basic/5-ipv6/#lab-wiring","text":"Origin Device Origin Port Destination Device Destination Port r1 eth1 r2 eth1 r2 eth2 r3 eth1","title":"Lab Wiring"},{"location":"basic/5-ipv6/#lab-addressing","text":"Node/Interface IPv4 Address IPv6 Address Description r1 10.0.0.1/32 2001:db8:cafe:1::1/64 Loopback eth1 10.1.0.1/30 LLA r1 -> r2 r2 10.0.0.2/32 2001:db8:cafe:2::1/64 Loopback eth1 10.1.0.2/30 LLA r2 -> r1 eth2 10.1.0.5/30 r2 -> r3 r3 10.0.0.3/32 2001:db8:cafe:3::1/64 Loopback eth1 10.1.0.6/30 r3 -> r2 I\u2019m positive you have to do both on some devices ;) \u21a9","title":"Lab Addressing"},{"location":"basic/6-level-2/","text":"Optimize Simple IS-IS Deployments In the Configure IS-IS Routing for IPv4 lab exercise, I told you to configure the routers as level-2 intermediate systems and promised a detailed explanation in a follow-up lab exercise. It\u2019s time to open that can of worms. To keep things simple, we\u2019ll use a simple lab topology: three routers connected into a triangle. Device Requirements Use any device supported by the netlab IS-IS configuration module . Starting the Lab Assuming you already set up your lab infrastructure : Change directory to basic/6-level-2 Execute netlab up Log into lab devices with netlab connect You\u2019ll get a lab with IPv4 addresses and minimal IS-IS configurations on all devices. Level-1 and Level-2 Routing in IS-IS The link-state routing protocols (IS-IS and OSPF) were designed to run on devices that were two orders of magnitude 1 slower than what we have today 2 and had three orders of magnitude less memory 3 . The routing protocol designers were rightfully worried about scalability challenges and implemented features that would allow them to build large networks: OSPF uses areas connected via a backbone area. IS-IS uses areas (level-1 routing) connected via an overlay inter-area routing topology (level-2 routing). Tip In a follow-up lab exercise, we\u2019ll discuss the details of multi-level routing. Today, we\u2019ll focus on the implications of using level-1 and level-2 routing on the same devices. The IS-IS multi-level routing rules are simple: An area is a contiguous set of routers with NETs that differ only in system IDs (everything left of the system ID is the same). Level-1 (intra-area) routers know the topology of their area but not what\u2019s in other areas. Level-2 (inter-area) routers know the inter-area topology but not the details of individual areas. Level-1-2 routers are like OSPF Area Border Routers. They know the topology of their area 4 and the inter-area topology. They also summarize intra-area reachability information (prefixes and costs) and advertise them into the inter-area topology (similar to what OSPF ABRs do). Contrary to OSPF (where an interface belongs to a single area), IS-IS routers could establish level-1 and level-2 adjacencies over the same interface. Level-1 routing and level-2 routing are entirely separate. While they use a shared adjacency 5 , they use different topology databases. Every router in an IS-IS network can be a level-1 router , a level-2 router , or a level-1-2 router . Furthermore, you could limit the adjacencies a router forms over individual interfaces (we\u2019ll leave this topic for another day). Now for the sad part: the default router type in most implementations is a level-1-2 router. Let\u2019s assume we have a reasonably small network 6 and don\u2019t use areas. Could the default setting hurt us? Best Scenario: Duplicate Information FRRouting is one of those implementations where running level-1 and level-2 routing in parallel causes only minor damage. As of August 2024, the FRRouting IS-IS implementation is incomplete and cannot distribute intra-area (level-1) information into inter-area (level-2) LSPs or vice versa 7 . Regardless, it\u2019s worth exploring this behavior, as other devices might have similar defaults 8 . If you start our lab with FRRouting nodes, you can observe level 3 adjacencies (that\u2019s how FRRouting says \u201clevel-1-2\u201d). The neighbor details confirm that the circuit type is L1L2 \u2013 we\u2019re running level-1 and level-2 routing with IS-IS neighbors. r1# show isis neighbor detail Area Gandalf: r2 Interface: eth1, Level: 3, State: Up, Expires in 28s Adjacency flaps: 2, Last: 25s ago Circuit type: L1L2, Speaks: IPv4 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.2 r3 Interface: eth2, Level: 3, State: Up, Expires in 27s Adjacency flaps: 2, Last: 25s ago Circuit type: L1L2, Speaks: IPv4 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.10 As expected, the routers have two IS-IS databases with duplicate information (the LSPs might have the exact same size): r1# show isis data Area Gandalf: IS-IS Level-1 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 112 0x00000002 0xcf99 1630 1/0/0 r2.00-00 112 0x00000002 0x0662 1638 1/0/0 r3.00-00 112 0x00000002 0x0e4d 1622 1/0/0 3 LSPs IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 112 0x00000002 0xc7a9 1642 0/0/0 r2.00-00 112 0x00000002 0xfd72 1622 0/0/0 r3.00-00 112 0x00000002 0x065d 1630 0/0/0 3 LSPs Inspecting a level-1 LSP and a corresponding level-2 LSP confirms the duplication of information: r1# show isis database detail r2.00-00 Area Gandalf: IS-IS Level-1 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r2.00-00 112 0x00000002 0x0662 1544 1/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: r2 TE Router ID: 10.0.0.2 Router Capability: 10.0.0.2 , D:0, S:0 Extended Reachability: 0000.0000.0001.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 10) IPv4 Interface Address: 10.0.0.2 Extended IP Reachability: 10.0.0.2/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10) IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r2.00-00 112 0x00000002 0xfd72 1528 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: r2 TE Router ID: 10.0.0.2 Router Capability: 10.0.0.2 , D:0, S:0 Extended Reachability: 0000.0000.0001.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 10) IPv4 Interface Address: 10.0.0.2 Extended IP Reachability: 10.0.0.2/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10) End result: Even without information propagation between level-1 and level-2 routing, the routers consume twice as much memory for the IS-IS topology database. More importantly 10 , every change in the network triggers two SPF 9 runs (one for level-1 topology, one for level-2 topology) with identical results (because every router advertises every prefix in level-1 and level-2 topologies). One of those results is thrown away; within an area, level-1 information takes precedence over level-2 information 11 . Worst Case: Exploding Information Most IS-IS implementations follow the rules from RFC 1195 : Level 2 routers include in their level 2 LSPs a complete list of [IP address, subnet mask, metric] specifying all IP addresses reachable in their area 12 . Now, imagine you\u2019re using an implementation that follows the RFC1195 rules in a single-area network where every router runs level-1 and level-2 routing. Every router advertises every reachable intra-area IP prefix in its level-2 LSP, resulting in humongous level-2 LSPs 13 . All those level-2 prefixes would needlessly increase the overhead of level-2 SPFs (and the results of the level-2 SPF would be ignored anyway). Even worse, every change in the network topology that would change the cost of at least one prefix would result in changed level-2 LSPs that would be flooded across the whole network, triggering even more level-2 SPF runs. Takeaway: In a single-area IS-IS network, never run level-1 and level-2 routing in parallel. You can reproduce that behavior with most IS-IS implementations. Start the lab and explore the contents of a level-1 LSP and corresponding level-2 LSP. This is what you would get on Arista cEOS: r1>show isis database r2.00-00 detail Legend: H - hostname conflict U - node unreachable IS-IS Instance: Gandalf VRF: default IS-IS Level 1 Link State Database LSPID Seq Num Cksum Life Length IS Received LSPID Flags r2.00-00 3 60631 1044 118 L2 0000.0000.0002.00-00 <> Remaining lifetime received: 1199 s Modified to: 1200 s NLPID: 0xCC(IPv4) Hostname: r2 Area addresses: 49.0001 Interface address: 10.1.0.5 Interface address: 10.1.0.2 Interface address: 10.0.0.2 IS Neighbor : r1.00 Metric: 10 IS Neighbor : r3.00 Metric: 10 Reachability : 10.1.0.4/30 Metric: 10 Type: 1 Up Reachability : 10.1.0.0/30 Metric: 10 Type: 1 Up Reachability : 10.0.0.2/32 Metric: 10 Type: 1 Up Router Capabilities: Router Id: 10.0.0.2 Flags: [] Area leader priority: 250 algorithm: 0 IS-IS Level 2 Link State Database LSPID Seq Num Cksum Life Length IS Received LSPID Flags r2.00-00 4 53131 1044 147 L2 0000.0000.0002.00-00 <> Remaining lifetime received: 1199 s Modified to: 1200 s NLPID: 0xCC(IPv4) Hostname: r2 Area addresses: 49.0001 Interface address: 10.1.0.5 Interface address: 10.1.0.2 Interface address: 10.0.0.2 IS Neighbor : r1.00 Metric: 10 IS Neighbor : r3.00 Metric: 10 Reachability : 10.0.0.1/32 Metric: 20 Type: 1 Up Reachability : 10.1.0.8/30 Metric: 20 Type: 1 Up Reachability : 10.0.0.3/32 Metric: 20 Type: 1 Up Reachability : 10.1.0.4/30 Metric: 10 Type: 1 Up Reachability : 10.1.0.0/30 Metric: 10 Type: 1 Up Reachability : 10.0.0.2/32 Metric: 10 Type: 1 Up Router Capabilities: Router Id: 10.0.0.2 Flags: [] Area leader priority: 250 algorithm: 0 Configure IS-IS Router Type By now, you probably agree that running level-1 routing and level-2 routing in parallel 14 does not make sense. Is it better to run just level-1 routing or just level-2 routing? I would go with level-2 routing; things will keep working even if you decide to split your network into smaller areas sometime in the future. It\u2019s time to get our hands dirty. After exploring the IS-IS database structures, configure all routers in your network to be level-2 routers with a router configuration command similar to is-type level-2 . Validation Examine the IS-IS adjacencies on all links in your network. All IS-IS neighbors should have level-2 adjacency: r1# sh isis neighbor Area Gandalf: System Id Interface L State Holdtime SNPA r2 eth1 2 Up 30 2020.2020.2020 r3 eth2 2 Up 29 2020.2020.2020 The IS-IS database should not have any level-1 information: r1# show isis database Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 112 0x00000005 0xc1ac 1644 0/0/0 r2.00-00 112 0x00000006 0xf576 1713 0/0/0 r3.00-00 112 0x00000007 0xfb62 1701 0/0/0 3 LSPs Reference Information Lab Wiring Origin Device Origin Port Destination Device Destination Port r1 eth1 r2 eth1 r2 eth2 r3 eth1 r1 eth2 r3 eth2 Lab Addressing Node/Interface IPv4 Address IPv6 Address Description r1 10.0.0.1/32 Loopback eth1 10.1.0.1/30 r1 -> r2 eth2 10.1.0.9/30 r1 -> r3 r2 10.0.0.2/32 Loopback eth1 10.1.0.2/30 r2 -> r1 eth2 10.1.0.5/30 r2 -> r3 r3 10.0.0.3/32 Loopback eth1 10.1.0.6/30 r3 -> r2 eth2 10.1.0.10/30 r3 -> r1 100 times \u21a9 The Cisco 2500 router had a 20 MHz CPU. Most general-purpose CPUs today use a clock frequency above 2 GHz (ignoring for the moment that they can also do much more in a single clock cycle). \u21a9 The Cisco 2500 router had up to 16 MB of memory. Most modern routers have at least 8 GB of (much faster) RAM. \u21a9 Contrary to OSPF, an IS-IS router can belong to a single area (ignoring the overlapping areas exception). \u21a9 That shared adjacency is advertised as two adjacencies (extended reachability TLV), one in level-1 LSP and another in level-2 LSP. \u21a9 ISPs were running networks with hundreds of routers in an IS-IS area in the 1990s. Most everyone agrees that (assuming you\u2019re using a decent implementation) it\u2019s OK to run a few hundred routers in a relatively stable IS-IS area (TLDR: It Depends\u2122\ufe0f) \u21a9 You cannot use FRRouting as a level-1-2 router in a network that uses multi-level IS-IS routing. \u21a9 Cisco Nexus OS does not distribute level-1 information into level-2 LSPs unless you configure distribute level-1 into level-2 within an IS-IS router address family. \u21a9 Shortest-Path First ; the algorithm used to find the lowest-cost paths in a weighted graph \u21a9 In the world of cheap RAM \u21a9 See section 3.2 of RFC 5302 for more details. \u21a9 RFC 5302 provides a slightly stricter interpretation in section 3.3 : a L1L2 router SHOULD only advertise in their L2 LSP those L1 routes that they use for forwarding themselves. They SHOULD NOT unconditionally advertise into L2 all prefixes from LSPs in the L1 database. \u21a9 OSPF would do the same thing if you configured virtual backbone links across a single-area OSPF network \u21a9 On all links in your network. In a network using multi-level IS-IS routing, you might have to run level-1 routing and level-2 routing on some core links (but you wouldn\u2019t do that on each link). \u21a9","title":"Optimize Simple IS-IS Deployments"},{"location":"basic/6-level-2/#optimize-simple-is-is-deployments","text":"In the Configure IS-IS Routing for IPv4 lab exercise, I told you to configure the routers as level-2 intermediate systems and promised a detailed explanation in a follow-up lab exercise. It\u2019s time to open that can of worms. To keep things simple, we\u2019ll use a simple lab topology: three routers connected into a triangle.","title":"Optimize Simple IS-IS Deployments"},{"location":"basic/6-level-2/#device-requirements","text":"Use any device supported by the netlab IS-IS configuration module .","title":"Device Requirements"},{"location":"basic/6-level-2/#starting-the-lab","text":"Assuming you already set up your lab infrastructure : Change directory to basic/6-level-2 Execute netlab up Log into lab devices with netlab connect You\u2019ll get a lab with IPv4 addresses and minimal IS-IS configurations on all devices.","title":"Starting the Lab"},{"location":"basic/6-level-2/#level-1-and-level-2-routing-in-is-is","text":"The link-state routing protocols (IS-IS and OSPF) were designed to run on devices that were two orders of magnitude 1 slower than what we have today 2 and had three orders of magnitude less memory 3 . The routing protocol designers were rightfully worried about scalability challenges and implemented features that would allow them to build large networks: OSPF uses areas connected via a backbone area. IS-IS uses areas (level-1 routing) connected via an overlay inter-area routing topology (level-2 routing). Tip In a follow-up lab exercise, we\u2019ll discuss the details of multi-level routing. Today, we\u2019ll focus on the implications of using level-1 and level-2 routing on the same devices. The IS-IS multi-level routing rules are simple: An area is a contiguous set of routers with NETs that differ only in system IDs (everything left of the system ID is the same). Level-1 (intra-area) routers know the topology of their area but not what\u2019s in other areas. Level-2 (inter-area) routers know the inter-area topology but not the details of individual areas. Level-1-2 routers are like OSPF Area Border Routers. They know the topology of their area 4 and the inter-area topology. They also summarize intra-area reachability information (prefixes and costs) and advertise them into the inter-area topology (similar to what OSPF ABRs do). Contrary to OSPF (where an interface belongs to a single area), IS-IS routers could establish level-1 and level-2 adjacencies over the same interface. Level-1 routing and level-2 routing are entirely separate. While they use a shared adjacency 5 , they use different topology databases. Every router in an IS-IS network can be a level-1 router , a level-2 router , or a level-1-2 router . Furthermore, you could limit the adjacencies a router forms over individual interfaces (we\u2019ll leave this topic for another day). Now for the sad part: the default router type in most implementations is a level-1-2 router. Let\u2019s assume we have a reasonably small network 6 and don\u2019t use areas. Could the default setting hurt us?","title":"Level-1 and Level-2 Routing in IS-IS"},{"location":"basic/6-level-2/#best-scenario-duplicate-information","text":"FRRouting is one of those implementations where running level-1 and level-2 routing in parallel causes only minor damage. As of August 2024, the FRRouting IS-IS implementation is incomplete and cannot distribute intra-area (level-1) information into inter-area (level-2) LSPs or vice versa 7 . Regardless, it\u2019s worth exploring this behavior, as other devices might have similar defaults 8 . If you start our lab with FRRouting nodes, you can observe level 3 adjacencies (that\u2019s how FRRouting says \u201clevel-1-2\u201d). The neighbor details confirm that the circuit type is L1L2 \u2013 we\u2019re running level-1 and level-2 routing with IS-IS neighbors. r1# show isis neighbor detail Area Gandalf: r2 Interface: eth1, Level: 3, State: Up, Expires in 28s Adjacency flaps: 2, Last: 25s ago Circuit type: L1L2, Speaks: IPv4 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.2 r3 Interface: eth2, Level: 3, State: Up, Expires in 27s Adjacency flaps: 2, Last: 25s ago Circuit type: L1L2, Speaks: IPv4 SNPA: 2020.2020.2020 Area Address(es): 49.0001 IPv4 Address(es): 10.1.0.10 As expected, the routers have two IS-IS databases with duplicate information (the LSPs might have the exact same size): r1# show isis data Area Gandalf: IS-IS Level-1 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 112 0x00000002 0xcf99 1630 1/0/0 r2.00-00 112 0x00000002 0x0662 1638 1/0/0 r3.00-00 112 0x00000002 0x0e4d 1622 1/0/0 3 LSPs IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 112 0x00000002 0xc7a9 1642 0/0/0 r2.00-00 112 0x00000002 0xfd72 1622 0/0/0 r3.00-00 112 0x00000002 0x065d 1630 0/0/0 3 LSPs Inspecting a level-1 LSP and a corresponding level-2 LSP confirms the duplication of information: r1# show isis database detail r2.00-00 Area Gandalf: IS-IS Level-1 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r2.00-00 112 0x00000002 0x0662 1544 1/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: r2 TE Router ID: 10.0.0.2 Router Capability: 10.0.0.2 , D:0, S:0 Extended Reachability: 0000.0000.0001.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 10) IPv4 Interface Address: 10.0.0.2 Extended IP Reachability: 10.0.0.2/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10) IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r2.00-00 112 0x00000002 0xfd72 1528 0/0/0 Protocols Supported: IPv4 Area Address: 49.0001 Hostname: r2 TE Router ID: 10.0.0.2 Router Capability: 10.0.0.2 , D:0, S:0 Extended Reachability: 0000.0000.0001.00 (Metric: 10) Extended Reachability: 0000.0000.0003.00 (Metric: 10) IPv4 Interface Address: 10.0.0.2 Extended IP Reachability: 10.0.0.2/32 (Metric: 10) Extended IP Reachability: 10.1.0.0/30 (Metric: 10) Extended IP Reachability: 10.1.0.4/30 (Metric: 10) End result: Even without information propagation between level-1 and level-2 routing, the routers consume twice as much memory for the IS-IS topology database. More importantly 10 , every change in the network triggers two SPF 9 runs (one for level-1 topology, one for level-2 topology) with identical results (because every router advertises every prefix in level-1 and level-2 topologies). One of those results is thrown away; within an area, level-1 information takes precedence over level-2 information 11 .","title":"Best Scenario: Duplicate Information"},{"location":"basic/6-level-2/#worst-case-exploding-information","text":"Most IS-IS implementations follow the rules from RFC 1195 : Level 2 routers include in their level 2 LSPs a complete list of [IP address, subnet mask, metric] specifying all IP addresses reachable in their area 12 . Now, imagine you\u2019re using an implementation that follows the RFC1195 rules in a single-area network where every router runs level-1 and level-2 routing. Every router advertises every reachable intra-area IP prefix in its level-2 LSP, resulting in humongous level-2 LSPs 13 . All those level-2 prefixes would needlessly increase the overhead of level-2 SPFs (and the results of the level-2 SPF would be ignored anyway). Even worse, every change in the network topology that would change the cost of at least one prefix would result in changed level-2 LSPs that would be flooded across the whole network, triggering even more level-2 SPF runs. Takeaway: In a single-area IS-IS network, never run level-1 and level-2 routing in parallel. You can reproduce that behavior with most IS-IS implementations. Start the lab and explore the contents of a level-1 LSP and corresponding level-2 LSP. This is what you would get on Arista cEOS: r1>show isis database r2.00-00 detail Legend: H - hostname conflict U - node unreachable IS-IS Instance: Gandalf VRF: default IS-IS Level 1 Link State Database LSPID Seq Num Cksum Life Length IS Received LSPID Flags r2.00-00 3 60631 1044 118 L2 0000.0000.0002.00-00 <> Remaining lifetime received: 1199 s Modified to: 1200 s NLPID: 0xCC(IPv4) Hostname: r2 Area addresses: 49.0001 Interface address: 10.1.0.5 Interface address: 10.1.0.2 Interface address: 10.0.0.2 IS Neighbor : r1.00 Metric: 10 IS Neighbor : r3.00 Metric: 10 Reachability : 10.1.0.4/30 Metric: 10 Type: 1 Up Reachability : 10.1.0.0/30 Metric: 10 Type: 1 Up Reachability : 10.0.0.2/32 Metric: 10 Type: 1 Up Router Capabilities: Router Id: 10.0.0.2 Flags: [] Area leader priority: 250 algorithm: 0 IS-IS Level 2 Link State Database LSPID Seq Num Cksum Life Length IS Received LSPID Flags r2.00-00 4 53131 1044 147 L2 0000.0000.0002.00-00 <> Remaining lifetime received: 1199 s Modified to: 1200 s NLPID: 0xCC(IPv4) Hostname: r2 Area addresses: 49.0001 Interface address: 10.1.0.5 Interface address: 10.1.0.2 Interface address: 10.0.0.2 IS Neighbor : r1.00 Metric: 10 IS Neighbor : r3.00 Metric: 10 Reachability : 10.0.0.1/32 Metric: 20 Type: 1 Up Reachability : 10.1.0.8/30 Metric: 20 Type: 1 Up Reachability : 10.0.0.3/32 Metric: 20 Type: 1 Up Reachability : 10.1.0.4/30 Metric: 10 Type: 1 Up Reachability : 10.1.0.0/30 Metric: 10 Type: 1 Up Reachability : 10.0.0.2/32 Metric: 10 Type: 1 Up Router Capabilities: Router Id: 10.0.0.2 Flags: [] Area leader priority: 250 algorithm: 0","title":"Worst Case: Exploding Information"},{"location":"basic/6-level-2/#configure-is-is-router-type","text":"By now, you probably agree that running level-1 routing and level-2 routing in parallel 14 does not make sense. Is it better to run just level-1 routing or just level-2 routing? I would go with level-2 routing; things will keep working even if you decide to split your network into smaller areas sometime in the future. It\u2019s time to get our hands dirty. After exploring the IS-IS database structures, configure all routers in your network to be level-2 routers with a router configuration command similar to is-type level-2 .","title":"Configure IS-IS Router Type"},{"location":"basic/6-level-2/#validation","text":"Examine the IS-IS adjacencies on all links in your network. All IS-IS neighbors should have level-2 adjacency: r1# sh isis neighbor Area Gandalf: System Id Interface L State Holdtime SNPA r2 eth1 2 Up 30 2020.2020.2020 r3 eth2 2 Up 29 2020.2020.2020 The IS-IS database should not have any level-1 information: r1# show isis database Area Gandalf: IS-IS Level-2 link-state database: LSP ID PduLen SeqNumber Chksum Holdtime ATT/P/OL r1.00-00 * 112 0x00000005 0xc1ac 1644 0/0/0 r2.00-00 112 0x00000006 0xf576 1713 0/0/0 r3.00-00 112 0x00000007 0xfb62 1701 0/0/0 3 LSPs","title":"Validation"},{"location":"basic/6-level-2/#reference-information","text":"","title":"Reference Information"},{"location":"basic/6-level-2/#lab-wiring","text":"Origin Device Origin Port Destination Device Destination Port r1 eth1 r2 eth1 r2 eth2 r3 eth1 r1 eth2 r3 eth2","title":"Lab Wiring"},{"location":"basic/6-level-2/#lab-addressing","text":"Node/Interface IPv4 Address IPv6 Address Description r1 10.0.0.1/32 Loopback eth1 10.1.0.1/30 r1 -> r2 eth2 10.1.0.9/30 r1 -> r3 r2 10.0.0.2/32 Loopback eth1 10.1.0.2/30 r2 -> r1 eth2 10.1.0.5/30 r2 -> r3 r3 10.0.0.3/32 Loopback eth1 10.1.0.6/30 r3 -> r2 eth2 10.1.0.10/30 r3 -> r1 100 times \u21a9 The Cisco 2500 router had a 20 MHz CPU. Most general-purpose CPUs today use a clock frequency above 2 GHz (ignoring for the moment that they can also do much more in a single clock cycle). \u21a9 The Cisco 2500 router had up to 16 MB of memory. Most modern routers have at least 8 GB of (much faster) RAM. \u21a9 Contrary to OSPF, an IS-IS router can belong to a single area (ignoring the overlapping areas exception). \u21a9 That shared adjacency is advertised as two adjacencies (extended reachability TLV), one in level-1 LSP and another in level-2 LSP. \u21a9 ISPs were running networks with hundreds of routers in an IS-IS area in the 1990s. Most everyone agrees that (assuming you\u2019re using a decent implementation) it\u2019s OK to run a few hundred routers in a relatively stable IS-IS area (TLDR: It Depends\u2122\ufe0f) \u21a9 You cannot use FRRouting as a level-1-2 router in a network that uses multi-level IS-IS routing. \u21a9 Cisco Nexus OS does not distribute level-1 information into level-2 LSPs unless you configure distribute level-1 into level-2 within an IS-IS router address family. \u21a9 Shortest-Path First ; the algorithm used to find the lowest-cost paths in a weighted graph \u21a9 In the world of cheap RAM \u21a9 See section 3.2 of RFC 5302 for more details. \u21a9 RFC 5302 provides a slightly stricter interpretation in section 3.3 : a L1L2 router SHOULD only advertise in their L2 LSP those L1 routes that they use for forwarding themselves. They SHOULD NOT unconditionally advertise into L2 all prefixes from LSPs in the L1 database. \u21a9 OSPF would do the same thing if you configured virtual backbone links across a single-area OSPF network \u21a9 On all links in your network. In a network using multi-level IS-IS routing, you might have to run level-1 routing and level-2 routing on some core links (but you wouldn\u2019t do that on each link). \u21a9","title":"Lab Addressing"}]}